<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Manipulación y agrupación de datos | AIS: Capacitación de R</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Manipulación y agrupación de datos | AIS: Capacitación de R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Manipulación y agrupación de datos | AIS: Capacitación de R" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Oliab Herrera Coria" />


<meta name="date" content="2023-06-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comandos-básicos-de-r..html"/>
<link rel="next" href="tarea.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Información del curso</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#temario"><i class="fa fa-check"></i>Temario</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introducción-a-r..html"><a href="introducción-a-r..html"><i class="fa fa-check"></i><b>1</b> Introducción a R.</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introducción-a-r..html"><a href="introducción-a-r..html#un-poco-de-historia"><i class="fa fa-check"></i><b>1.1</b> Un poco de historia</a></li>
<li class="chapter" data-level="1.2" data-path="introducción-a-r..html"><a href="introducción-a-r..html#quién-usa-r"><i class="fa fa-check"></i><b>1.2</b> ¿Quién usa R?</a></li>
<li class="chapter" data-level="1.3" data-path="introducción-a-r..html"><a href="introducción-a-r..html#instalación-de-r-y-r-studio."><i class="fa fa-check"></i><b>1.3</b> Instalación de R y R Studio.</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introducción-a-r..html"><a href="introducción-a-r..html#instalar-r-en-windows."><i class="fa fa-check"></i><b>1.3.1</b> Instalar R en Windows.</a></li>
<li class="chapter" data-level="1.3.2" data-path="introducción-a-r..html"><a href="introducción-a-r..html#instalar-r-en-mac."><i class="fa fa-check"></i><b>1.3.2</b> Instalar R en Mac.</a></li>
<li class="chapter" data-level="1.3.3" data-path="introducción-a-r..html"><a href="introducción-a-r..html#instalar-rstudio"><i class="fa fa-check"></i><b>1.3.3</b> Instalar RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introducción-a-r..html"><a href="introducción-a-r..html#entorno-de-trabajo-de-rstudio."><i class="fa fa-check"></i><b>1.4</b> Entorno de trabajo de RStudio.</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introducción-a-r..html"><a href="introducción-a-r..html#consola"><i class="fa fa-check"></i><b>1.4.1</b> Consola</a></li>
<li class="chapter" data-level="1.4.2" data-path="introducción-a-r..html"><a href="introducción-a-r..html#scripts"><i class="fa fa-check"></i><b>1.4.2</b> Scripts</a></li>
<li class="chapter" data-level="1.4.3" data-path="introducción-a-r..html"><a href="introducción-a-r..html#entorno"><i class="fa fa-check"></i><b>1.4.3</b> Entorno</a></li>
<li class="chapter" data-level="1.4.4" data-path="introducción-a-r..html"><a href="introducción-a-r..html#otros-recursos"><i class="fa fa-check"></i><b>1.4.4</b> Otros recursos</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introducción-a-r..html"><a href="introducción-a-r..html#configuración-del-espacio-de-trabajo"><i class="fa fa-check"></i><b>1.5</b> Configuración del espacio de trabajo</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introducción-a-r..html"><a href="introducción-a-r..html#opción-1-fijar-directorio"><i class="fa fa-check"></i><b>1.5.1</b> Opción 1: Fijar directorio</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introducción-a-r..html"><a href="introducción-a-r..html#opción-2-proyecto-de-r."><i class="fa fa-check"></i><b>1.6</b> Opción 2 : Proyecto de R.</a></li>
<li class="chapter" data-level="1.7" data-path="introducción-a-r..html"><a href="introducción-a-r..html#instalación-de-paquetes."><i class="fa fa-check"></i><b>1.7</b> Instalación de paquetes.</a></li>
<li class="chapter" data-level="1.8" data-path="introducción-a-r..html"><a href="introducción-a-r..html#ayuda-en-r."><i class="fa fa-check"></i><b>1.8</b> Ayuda en R.</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html"><i class="fa fa-check"></i><b>2</b> Comandos básicos de R.</a>
<ul>
<li class="chapter" data-level="2.1" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#introducción"><i class="fa fa-check"></i><b>2.1</b> Introducción</a></li>
<li class="chapter" data-level="2.2" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#vectores"><i class="fa fa-check"></i><b>2.2</b> Vectores</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#acceder-a-un-elemento-de-un-objeto"><i class="fa fa-check"></i><b>2.2.1</b> Acceder a un elemento de un objeto</a></li>
<li class="chapter" data-level="2.2.2" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#enlistar-y-borrar-objetos"><i class="fa fa-check"></i><b>2.2.2</b> Enlistar y borrar objetos</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#tipos-de-objetos"><i class="fa fa-check"></i><b>2.3</b> Tipos de objetos</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#matrices"><i class="fa fa-check"></i><b>2.3.1</b> Matrices</a></li>
<li class="chapter" data-level="2.3.2" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#listas"><i class="fa fa-check"></i><b>2.3.2</b> Listas</a></li>
<li class="chapter" data-level="2.3.3" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#data-frame"><i class="fa fa-check"></i><b>2.3.3</b> Data Frame</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#manipulación-y-limpieza-de-datos."><i class="fa fa-check"></i><b>2.4</b> Manipulación y limpieza de datos.</a>
<ul>
<li class="chapter" data-level="" data-path="comandos-básicos-de-r..html"><a href="comandos-básicos-de-r..html#paquetes-y-el-tidyverse"><i class="fa fa-check"></i>Paquetes y el Tidyverse</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html"><i class="fa fa-check"></i><b>3</b> Manipulación y agrupación de datos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#transformación-de-datos"><i class="fa fa-check"></i><b>3.1</b> Transformación de datos</a>
<ul>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#datos-tidy"><i class="fa fa-check"></i>Datos Tidy</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#separa-aplica-combina-split-apply-combine"><i class="fa fa-check"></i>Separa-aplica-combina (<em>split-apply-combine</em>)</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#ejemplos-y-lectura-de-datos"><i class="fa fa-check"></i>Ejemplos y lectura de datos</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#filtrar"><i class="fa fa-check"></i>Filtrar</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#seleccionar"><i class="fa fa-check"></i>Seleccionar</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#ordenar"><i class="fa fa-check"></i>Ordenar</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#mutar"><i class="fa fa-check"></i>Mutar</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#summarise-y-resúmenes-por-grupo"><i class="fa fa-check"></i>Summarise y resúmenes por grupo</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#operador-pipeline"><i class="fa fa-check"></i>Operador pipeline</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#variables-por-grupo"><i class="fa fa-check"></i>Variables por grupo</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#verbos-de-dos-tablas"><i class="fa fa-check"></i>Verbos de dos tablas</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#datos-limpios"><i class="fa fa-check"></i><b>3.2</b> Datos limpios</a>
<ul>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#limpieza-bases-de-datos"><i class="fa fa-check"></i>Limpieza bases de datos</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#los-encabezados-de-las-columanas-son-valores"><i class="fa fa-check"></i>Los encabezados de las columanas son valores</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#una-columna-asociada-a-más-de-una-variable"><i class="fa fa-check"></i>Una columna asociada a más de una variable</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#variables-almacenadas-en-filas-y-columnas"><i class="fa fa-check"></i>Variables almacenadas en filas y columnas</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#mas-de-un-tipo-de-observación-en-una-misma-tabla"><i class="fa fa-check"></i>Mas de un tipo de observación en una misma tabla</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#una-misma-unidad-observacional-está-almacenada-en-múltiples-tablas"><i class="fa fa-check"></i>Una misma unidad observacional está almacenada en múltiples tablas</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#otras-consideraciones"><i class="fa fa-check"></i>Otras consideraciones</a></li>
<li class="chapter" data-level="" data-path="manipulación-y-agrupación-de-datos.html"><a href="manipulación-y-agrupación-de-datos.html#recursos-adicionales"><i class="fa fa-check"></i>Recursos adicionales</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tarea.html"><a href="tarea.html"><i class="fa fa-check"></i><b>4</b> Tarea</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tarea.html"><a href="tarea.html#tarea-1-estructuras-de-datos"><i class="fa fa-check"></i><b>4.1</b> Tarea 1: Estructuras de Datos</a></li>
<li class="chapter" data-level="4.2" data-path="tarea.html"><a href="tarea.html#respuesta-tarea-1-estructuras-de-datos"><i class="fa fa-check"></i><b>4.2</b> Respuesta Tarea 1: Estructuras de Datos</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html"><i class="fa fa-check"></i><b>5</b> Gráficas: GGPLOT2</a>
<ul>
<li class="chapter" data-level="5.1" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#visualización-con-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Visualización con ggplot2</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#geom_point-o-gráficos-de-dispersion-scatter-plots"><i class="fa fa-check"></i><b>5.1.1</b> geom_point o gráficos de dispersion (scatter plots)</a></li>
<li class="chapter" data-level="5.1.2" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#texto-geom_text"><i class="fa fa-check"></i><b>5.1.2</b> Texto (geom_text())</a></li>
<li class="chapter" data-level="5.1.3" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#aesteticos-vs.-asignacion"><i class="fa fa-check"></i><b>5.1.3</b> Aesteticos vs. asignacion</a></li>
<li class="chapter" data-level="5.1.4" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#incluir-varios-aesteticos"><i class="fa fa-check"></i><b>5.1.4</b> Incluir varios aesteticos</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#ejercicio-1"><i class="fa fa-check"></i><b>5.2</b> Ejercicio</a></li>
<li class="chapter" data-level="5.3" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#geom_line-graficos-de-lineas"><i class="fa fa-check"></i><b>5.3</b> geom_line() graficos de lineas</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#ejercicio-2"><i class="fa fa-check"></i><b>5.3.1</b> Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#geom_boxplot-diagramas-de-caja"><i class="fa fa-check"></i><b>5.4</b> geom_boxplot() Diagramas de caja</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#ejercicio-3"><i class="fa fa-check"></i><b>5.4.1</b> Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="gráficas-ggplot2.html"><a href="gráficas-ggplot2.html#geom_bar-diagrama-de-barras"><i class="fa fa-check"></i><b>5.5</b> geom_bar() diagrama de barras</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AIS: Capacitación de R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulación-y-agrupación-de-datos" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Manipulación y agrupación de datos<a href="manipulación-y-agrupación-de-datos.html#manipulación-y-agrupación-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>El material de la clase se puede descargar de <a href="https://www.dropbox.com/s/gtxjn5xb39g2n09/02-manipulacion.zip?dl=0">aquí</a>.</strong></p>
<p>En esta sección continuamos con la introducción a R para análisis de datos,
en particular mostraremos herramientas de manipulación y transformación de
datos. Trataremos los siguientes puntos:</p>
<ul>
<li><p>Estrategia separa-aplica-combina.</p></li>
<li><p>Reestructura de datos y el principio de los datos limpios.</p></li>
</ul>
<p>Es sabido que limpieza y preparación de datos ocupan gran parte del tiempo del
análisis de datos (<a href="http://onlinelibrary.wiley.com/book/10.1002/0471448354">Dasu y Johnson, 2003</a>
y <a href="https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html?mcubz=0">NYT’s ‘Janitor Work’ Is Key Hurdle to Insights</a>),
es por ello que vale la pena dedicar un tiempo a aprender técnicas que faciliten
estas tareas, y entender que estructura en los datos es más conveniente para
trabajar.</p>
<div id="transformación-de-datos" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Transformación de datos<a href="manipulación-y-agrupación-de-datos.html#transformación-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="datos-tidy" class="section level3 unnumbered hasAnchor">
<h3>Datos Tidy<a href="manipulación-y-agrupación-de-datos.html#datos-tidy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una base de datos tidy es una base de datos en la cuál:</p>
<ul>
<li><strong>Cada vararible que se medida debe estar en una columna.</strong></li>
<li><strong>Cada observación distinta de esa variable debe estar en una fila diferente.</strong></li>
<li><strong>Cada valor debe de estar en su propia celda</strong></li>
</ul>
<p>En general, la forma en que representaríamos una base de datos tidy en R es usando un data frame.</p>
<p><img src="imagenes/tidy.png" /></p>
<p>Por ejemplo, los datos del Secretariado ejecutivo:</p>
<ul>
<li>Datos con la misma variable en diferentes columnas</li>
</ul>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;     Año Clave_Ent Entidad    Bien …¹ Tipo …² Subti…³ Modal…⁴ Enero Febrero Marzo
#&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  2021         1 Aguascali… La vid… Homici… Homici… Con ar…     2       1     4
#&gt; 2  2021         1 Aguascali… La vid… Homici… Homici… Con ar…     1       1     1
#&gt; 3  2021         1 Aguascali… La vid… Homici… Homici… Con ot…     0       3     1
#&gt; 4  2021         1 Aguascali… La vid… Homici… Homici… No esp…     0       0     0
#&gt; 5  2021         1 Aguascali… La vid… Homici… Homici… Con ar…     0       0     0
#&gt; 6  2021         1 Aguascali… La vid… Homici… Homici… Con ar…     0       0     0
#&gt; # … with 9 more variables: Abril &lt;dbl&gt;, Mayo &lt;dbl&gt;, Junio &lt;dbl&gt;, Julio &lt;dbl&gt;,
#&gt; #   Agosto &lt;dbl&gt;, Septiembre &lt;dbl&gt;, Octubre &lt;dbl&gt;, Noviembre &lt;dbl&gt;,
#&gt; #   Diciembre &lt;dbl&gt;, and abbreviated variable names ¹​`Bien jurídico afectado`,
#&gt; #   ²​`Tipo de delito`, ³​`Subtipo de delito`, ⁴​Modalidad</code></pre>
<pre><code>#&gt; # A tibble: 20 × 9
#&gt;      Año Clave_Ent Entidad        Bien j…¹ Tipo …² Subti…³ Modal…⁴ mes   total…⁵
#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
#&gt;  1  2021         1 Aguascalientes La vida… Homici… Homici… Con ar… Enero       2
#&gt;  2  2021         1 Aguascalientes La vida… Homici… Homici… Con ar… Enero       1
#&gt;  3  2021         1 Aguascalientes La vida… Homici… Homici… Con ot… Enero       0
#&gt;  4  2021         1 Aguascalientes La vida… Homici… Homici… No esp… Enero       0
#&gt;  5  2021         1 Aguascalientes La vida… Homici… Homici… Con ar… Enero       0
#&gt;  6  2021         1 Aguascalientes La vida… Homici… Homici… Con ar… Enero       0
#&gt;  7  2021         1 Aguascalientes La vida… Homici… Homici… En acc… Enero       8
#&gt;  8  2021         1 Aguascalientes La vida… Homici… Homici… Con ot… Enero       0
#&gt;  9  2021         1 Aguascalientes La vida… Homici… Homici… No esp… Enero       0
#&gt; 10  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ar… Enero       5
#&gt; 11  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ar… Enero       7
#&gt; 12  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ot… Enero     160
#&gt; 13  2021         1 Aguascalientes La vida… Lesion… Lesion… No esp… Enero      56
#&gt; 14  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ar… Enero       0
#&gt; 15  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ar… Enero       0
#&gt; 16  2021         1 Aguascalientes La vida… Lesion… Lesion… En acc… Enero      59
#&gt; 17  2021         1 Aguascalientes La vida… Lesion… Lesion… Con ot… Enero       0
#&gt; 18  2021         1 Aguascalientes La vida… Lesion… Lesion… No esp… Enero      18
#&gt; 19  2021         1 Aguascalientes La vida… Femini… Femini… Con ar… Enero       0
#&gt; 20  2021         1 Aguascalientes La vida… Femini… Femini… Con ar… Enero       1
#&gt; # … with abbreviated variable names ¹​`Bien jurídico afectado`,
#&gt; #   ²​`Tipo de delito`, ³​`Subtipo de delito`, ⁴​Modalidad, ⁵​total_delitos</code></pre>
<pre><code>#&gt; # A tibble: 40 × 33
#&gt; # Groups:   Tipo de delito [40]
#&gt;    Tipo de del…¹ Aguas…² Baja …³ Baja …⁴ Campe…⁵ Chiapas Chihu…⁶ Ciuda…⁷ Coahu…⁸
#&gt;    &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1 Aborto              0       1       1       0       3       1       8       0
#&gt;  2 Abuso de con…      50      29      12       0       4      60     302      52
#&gt;  3 Abuso sexual        0      70      20       3      17     103     206      46
#&gt;  4 Acoso sexual        0       0       8       0       7       0      86      15
#&gt;  5 Allanamiento…      35     185       9       6       8      70      47      39
#&gt;  6 Amenazas          227     324     102       5      26     248    1110     359
#&gt;  7 Contra el me…       2       0       0       0       1      18      45       0
#&gt;  8 Corrupción d…       5      50       3       0       3       5      21       3
#&gt;  9 Daño a la pr…     317     576      85      12      67     656     697     459
#&gt; 10 Delitos come…      47      69      18       0      10     134     307      13
#&gt; # … with 30 more rows, 24 more variables: Colima &lt;dbl&gt;, Durango &lt;dbl&gt;,
#&gt; #   Guanajuato &lt;dbl&gt;, Guerrero &lt;dbl&gt;, Hidalgo &lt;dbl&gt;, Jalisco &lt;dbl&gt;,
#&gt; #   México &lt;dbl&gt;, `Michoacán de Ocampo` &lt;dbl&gt;, Morelos &lt;dbl&gt;, Nayarit &lt;dbl&gt;,
#&gt; #   `Nuevo León` &lt;dbl&gt;, Oaxaca &lt;dbl&gt;, Puebla &lt;dbl&gt;, Querétaro &lt;dbl&gt;,
#&gt; #   `Quintana Roo` &lt;dbl&gt;, `San Luis Potosí` &lt;dbl&gt;, Sinaloa &lt;dbl&gt;, Sonora &lt;dbl&gt;,
#&gt; #   Tabasco &lt;dbl&gt;, Tamaulipas &lt;dbl&gt;, Tlaxcala &lt;dbl&gt;,
#&gt; #   `Veracruz de Ignacio de la Llave` &lt;dbl&gt;, Yucatán &lt;dbl&gt;, Zacatecas &lt;dbl&gt;, …</code></pre>
<pre><code>#&gt;             estado municipio     mes total_delitos
#&gt; 1 Estado de México      &lt;NA&gt;   Enero           143
#&gt; 2 Estado de México      &lt;NA&gt; Febrero           234
#&gt; 3 Estado de México      &lt;NA&gt;   Marzo           532
#&gt; 4             &lt;NA&gt;    Toluca   Enero            12
#&gt; 5             &lt;NA&gt;    Toluca Febrero             4
#&gt; 6             &lt;NA&gt;    Toluca   Marzo            55</code></pre>
</div>
<div id="separa-aplica-combina-split-apply-combine" class="section level3 unnumbered hasAnchor">
<h3>Separa-aplica-combina (<em>split-apply-combine</em>)<a href="manipulación-y-agrupación-de-datos.html#separa-aplica-combina-split-apply-combine" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Muchos problemas de análisis de datos involucran la aplicación de la estrategia
separa-aplica-combina <span class="citation">(<a href="#ref-plyr" role="doc-biblioref"><strong>plyr?</strong></a>)</span>,
esta consiste en romper un problema en pedazos (de
acuerdo a una variable de interés), operar sobre cada subconjunto de manera
independiente (ej. calcular la media de cada grupo, ordenar observaciones por
grupo, estandarizar por grupo) y después unir los pedazos nuevamente. El
siguiente diagrama ejemplifiaca el paradigma de divide-aplica-combina:</p>
<ul>
<li><strong>Separa</strong> la base de datos original.<br />
</li>
<li><strong>Aplica</strong> funciones a cada subconjunto.<br />
</li>
<li><strong>Combina</strong> los resultados en una nueva base de datos.</li>
</ul>
<p><img src="imagenes/split-apply-combine.png" /></p>
<p>Ahora, cuando pensamos como implementar la estrategia divide-aplica-combina es
natural pensar en iteraciones, por ejemplo utilizar un ciclo <code>for</code> para recorrer
cada grupo de interés y aplicar las funciones, sin embargo la aplicación de
ciclos <code>for</code> desemboca en código difícil de entender por lo que preferimos
trabajar con funciones creadas para estas tareas, usaremos el paquete
<code>dplyr</code> que además de ser más claro suele ser más veloz.</p>
<p>Estudiaremos las siguientes funciones:</p>
<ul>
<li><strong>filter</strong>: obten un subconjunto de las filas de acuerdo a un criterio.</li>
<li><strong>select</strong>: selecciona columnas de acuerdo al nombre</li>
<li><strong>arrange</strong>: reordena las filas</li>
<li><strong>mutate</strong>: agrega nuevas variables</li>
<li><strong>summarise</strong>: reduce variables a valores (crear nuevas bases de datos con
resúmenes de variables de la base original)</li>
</ul>
<p>Estas funciones trabajan de manera similar, el primer argumento que reciben
es un <em>data frame</em>, los argumentos que siguen
indican que operación se va a efectuar y el resultado es un nuevo <em>data frame</em>.</p>
<p>Adicionalmente, se pueden usar con <strong>group_by</strong> que cambia el dominio de cada
función, pasando de operar en el conjunto de datos completos a operar en
grupos, esto lo veremos más adelante.</p>
</div>
<div id="ejemplos-y-lectura-de-datos" class="section level3 unnumbered hasAnchor">
<h3>Ejemplos y lectura de datos<a href="manipulación-y-agrupación-de-datos.html#ejemplos-y-lectura-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En esta sección trabajaremos con bases de datos de vuelos del aeropuerto de
Houston. Comenzamos importando los datos a R.</p>
<p>Para leer los datos usamos funciones del paquete <code>readr</code> que forma parte del
<code>tidyverse</code>, notemos que si estamos usando RStudio podemos generar los comandos
de lectura de datos usando la opción <em>Import Dataset</em> en la ventana de
<em>Environment</em>.</p>
<p><img src="imagenes/importar_RStudio.png" /></p>
<p>Si usamos la opción de importar datos usando la funcionalidad <em>point-and-click</em>
de RStudio, es importante copiar los comandos al script de R para no perder
reproducibilidad.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="manipulación-y-agrupación-de-datos.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb216-2"><a href="manipulación-y-agrupación-de-datos.html#cb216-2" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/flights.csv&quot;</span>)</span>
<span id="cb216-3"><a href="manipulación-y-agrupación-de-datos.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 227496 Columns: 14</span></span>
<span id="cb216-4"><a href="manipulación-y-agrupación-de-datos.html#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb216-5"><a href="manipulación-y-agrupación-de-datos.html#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb216-6"><a href="manipulación-y-agrupación-de-datos.html#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr   (3): carrier, dest, plane</span></span>
<span id="cb216-7"><a href="manipulación-y-agrupación-de-datos.html#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl  (10): hour, minute, dep, arr, dep_delay, arr_delay, flight, cancelled, ...</span></span>
<span id="cb216-8"><a href="manipulación-y-agrupación-de-datos.html#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dttm  (1): date</span></span>
<span id="cb216-9"><a href="manipulación-y-agrupación-de-datos.html#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb216-10"><a href="manipulación-y-agrupación-de-datos.html#cb216-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb216-11"><a href="manipulación-y-agrupación-de-datos.html#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb216-12"><a href="manipulación-y-agrupación-de-datos.html#cb216-12" aria-hidden="true" tabindex="-1"></a>flights</span>
<span id="cb216-13"><a href="manipulación-y-agrupación-de-datos.html#cb216-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 227,496 × 14</span></span>
<span id="cb216-14"><a href="manipulación-y-agrupación-de-datos.html#cb216-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    date                 hour minute   dep   arr dep_delay arr_d…¹ carrier flight</span></span>
<span id="cb216-15"><a href="manipulación-y-agrupación-de-datos.html#cb216-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dttm&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span id="cb216-16"><a href="manipulación-y-agrupación-de-datos.html#cb216-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2011-01-01 12:00:00    14      0  1400  1500         0     -10 AA         428</span></span>
<span id="cb216-17"><a href="manipulación-y-agrupación-de-datos.html#cb216-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2011-01-02 12:00:00    14      1  1401  1501         1      -9 AA         428</span></span>
<span id="cb216-18"><a href="manipulación-y-agrupación-de-datos.html#cb216-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2011-01-03 12:00:00    13     52  1352  1502        -8      -8 AA         428</span></span>
<span id="cb216-19"><a href="manipulación-y-agrupación-de-datos.html#cb216-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2011-01-04 12:00:00    14      3  1403  1513         3       3 AA         428</span></span>
<span id="cb216-20"><a href="manipulación-y-agrupación-de-datos.html#cb216-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2011-01-05 12:00:00    14      5  1405  1507         5      -3 AA         428</span></span>
<span id="cb216-21"><a href="manipulación-y-agrupación-de-datos.html#cb216-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2011-01-06 12:00:00    13     59  1359  1503        -1      -7 AA         428</span></span>
<span id="cb216-22"><a href="manipulación-y-agrupación-de-datos.html#cb216-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2011-01-07 12:00:00    13     59  1359  1509        -1      -1 AA         428</span></span>
<span id="cb216-23"><a href="manipulación-y-agrupación-de-datos.html#cb216-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2011-01-08 12:00:00    13     55  1355  1454        -5     -16 AA         428</span></span>
<span id="cb216-24"><a href="manipulación-y-agrupación-de-datos.html#cb216-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2011-01-09 12:00:00    14     43  1443  1554        43      44 AA         428</span></span>
<span id="cb216-25"><a href="manipulación-y-agrupación-de-datos.html#cb216-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2011-01-10 12:00:00    14     43  1443  1553        43      43 AA         428</span></span>
<span id="cb216-26"><a href="manipulación-y-agrupación-de-datos.html#cb216-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 227,486 more rows, 5 more variables: dest &lt;chr&gt;, plane &lt;chr&gt;,</span></span>
<span id="cb216-27"><a href="manipulación-y-agrupación-de-datos.html#cb216-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   cancelled &lt;dbl&gt;, time &lt;dbl&gt;, dist &lt;dbl&gt;, and abbreviated variable name</span></span>
<span id="cb216-28"><a href="manipulación-y-agrupación-de-datos.html#cb216-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​arr_delay</span></span>
<span id="cb216-29"><a href="manipulación-y-agrupación-de-datos.html#cb216-29" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/weather.csv&quot;</span>)</span>
<span id="cb216-30"><a href="manipulación-y-agrupación-de-datos.html#cb216-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 8723 Columns: 14</span></span>
<span id="cb216-31"><a href="manipulación-y-agrupación-de-datos.html#cb216-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb216-32"><a href="manipulación-y-agrupación-de-datos.html#cb216-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb216-33"><a href="manipulación-y-agrupación-de-datos.html#cb216-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr   (3): wind_dir, conditions, events</span></span>
<span id="cb216-34"><a href="manipulación-y-agrupación-de-datos.html#cb216-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl  (10): hour, temp, dew_point, humidity, pressure, visibility, wind_dir2,...</span></span>
<span id="cb216-35"><a href="manipulación-y-agrupación-de-datos.html#cb216-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; date  (1): date</span></span>
<span id="cb216-36"><a href="manipulación-y-agrupación-de-datos.html#cb216-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb216-37"><a href="manipulación-y-agrupación-de-datos.html#cb216-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb216-38"><a href="manipulación-y-agrupación-de-datos.html#cb216-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb216-39"><a href="manipulación-y-agrupación-de-datos.html#cb216-39" aria-hidden="true" tabindex="-1"></a>weather </span>
<span id="cb216-40"><a href="manipulación-y-agrupación-de-datos.html#cb216-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8,723 × 14</span></span>
<span id="cb216-41"><a href="manipulación-y-agrupación-de-datos.html#cb216-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    date        hour  temp dew_point humidity pressure visibility wind_…¹ wind_…²</span></span>
<span id="cb216-42"><a href="manipulación-y-agrupación-de-datos.html#cb216-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb216-43"><a href="manipulación-y-agrupación-de-datos.html#cb216-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2011-01-01     0  59        28.9       32     29.9         10 NNE          20</span></span>
<span id="cb216-44"><a href="manipulación-y-agrupación-de-datos.html#cb216-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2011-01-01     1  57.2      28.4       33     29.9         10 NNE          20</span></span>
<span id="cb216-45"><a href="manipulación-y-agrupación-de-datos.html#cb216-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2011-01-01     2  55.4      28.4       36     29.9         10 NNW         340</span></span>
<span id="cb216-46"><a href="manipulación-y-agrupación-de-datos.html#cb216-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2011-01-01     3  53.6      28.4       38     29.9         10 North       350</span></span>
<span id="cb216-47"><a href="manipulación-y-agrupación-de-datos.html#cb216-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2011-01-01     4  NA        NA         NA     30.0         10 NNW         340</span></span>
<span id="cb216-48"><a href="manipulación-y-agrupación-de-datos.html#cb216-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2011-01-01     5  NA        NA         NA     30.0         10 North       350</span></span>
<span id="cb216-49"><a href="manipulación-y-agrupación-de-datos.html#cb216-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2011-01-01     6  53.1      17.1       24     30.0         10 North       360</span></span>
<span id="cb216-50"><a href="manipulación-y-agrupación-de-datos.html#cb216-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2011-01-01     7  53.1      16         23     30.1         10 North        10</span></span>
<span id="cb216-51"><a href="manipulación-y-agrupación-de-datos.html#cb216-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2011-01-01     8  54        18         24     30.1         10 North        10</span></span>
<span id="cb216-52"><a href="manipulación-y-agrupación-de-datos.html#cb216-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2011-01-01     9  55.4      17.6       23     30.1         10 NNE          20</span></span>
<span id="cb216-53"><a href="manipulación-y-agrupación-de-datos.html#cb216-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8,713 more rows, 5 more variables: wind_speed &lt;dbl&gt;, gust_speed &lt;dbl&gt;,</span></span>
<span id="cb216-54"><a href="manipulación-y-agrupación-de-datos.html#cb216-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   precip &lt;dbl&gt;, conditions &lt;chr&gt;, events &lt;chr&gt;, and abbreviated variable</span></span>
<span id="cb216-55"><a href="manipulación-y-agrupación-de-datos.html#cb216-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   names ¹​wind_dir, ²​wind_dir2</span></span>
<span id="cb216-56"><a href="manipulación-y-agrupación-de-datos.html#cb216-56" aria-hidden="true" tabindex="-1"></a>planes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/planes.csv&quot;</span>)</span>
<span id="cb216-57"><a href="manipulación-y-agrupación-de-datos.html#cb216-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 2853 Columns: 9</span></span>
<span id="cb216-58"><a href="manipulación-y-agrupación-de-datos.html#cb216-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb216-59"><a href="manipulación-y-agrupación-de-datos.html#cb216-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb216-60"><a href="manipulación-y-agrupación-de-datos.html#cb216-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr (5): plane, mfr, model, engine, type</span></span>
<span id="cb216-61"><a href="manipulación-y-agrupación-de-datos.html#cb216-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl (4): year, no.eng, no.seats, speed</span></span>
<span id="cb216-62"><a href="manipulación-y-agrupación-de-datos.html#cb216-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb216-63"><a href="manipulación-y-agrupación-de-datos.html#cb216-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb216-64"><a href="manipulación-y-agrupación-de-datos.html#cb216-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb216-65"><a href="manipulación-y-agrupación-de-datos.html#cb216-65" aria-hidden="true" tabindex="-1"></a>planes</span>
<span id="cb216-66"><a href="manipulación-y-agrupación-de-datos.html#cb216-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,853 × 9</span></span>
<span id="cb216-67"><a href="manipulación-y-agrupación-de-datos.html#cb216-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    plane   year mfr               model        no.eng no.se…¹ speed engine type </span></span>
<span id="cb216-68"><a href="manipulación-y-agrupación-de-datos.html#cb216-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;</span></span>
<span id="cb216-69"><a href="manipulación-y-agrupación-de-datos.html#cb216-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 N576AA  1991 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-70"><a href="manipulación-y-agrupación-de-datos.html#cb216-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 N557AA  1993 MARZ BARRY        KITFOX IV         1       2    NA Recip… Fixe…</span></span>
<span id="cb216-71"><a href="manipulación-y-agrupación-de-datos.html#cb216-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 N403AA  1974 RAVEN             S55A             NA       1    60 None   Ball…</span></span>
<span id="cb216-72"><a href="manipulación-y-agrupación-de-datos.html#cb216-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 N492AA  1989 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-73"><a href="manipulación-y-agrupación-de-datos.html#cb216-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 N262AA  1985 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-74"><a href="manipulación-y-agrupación-de-datos.html#cb216-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 N493AA  1989 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-75"><a href="manipulación-y-agrupación-de-datos.html#cb216-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 N477AA  1988 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-76"><a href="manipulación-y-agrupación-de-datos.html#cb216-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 N476AA  1988 MCDONNELL DOUGLAS DC-9-82(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-77"><a href="manipulación-y-agrupación-de-datos.html#cb216-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 N504AA    NA AUTHIER ANTHONY P TIERRA II         1       2    NA Recip… Fixe…</span></span>
<span id="cb216-78"><a href="manipulación-y-agrupación-de-datos.html#cb216-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 N565AA  1987 MCDONNELL DOUGLAS DC-9-83(MD-…      2     172    NA Turbo… Fixe…</span></span>
<span id="cb216-79"><a href="manipulación-y-agrupación-de-datos.html#cb216-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2,843 more rows, and abbreviated variable name ¹​no.seats</span></span>
<span id="cb216-80"><a href="manipulación-y-agrupación-de-datos.html#cb216-80" aria-hidden="true" tabindex="-1"></a>airports <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/airports.csv&quot;</span>)</span>
<span id="cb216-81"><a href="manipulación-y-agrupación-de-datos.html#cb216-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 3376 Columns: 7</span></span>
<span id="cb216-82"><a href="manipulación-y-agrupación-de-datos.html#cb216-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb216-83"><a href="manipulación-y-agrupación-de-datos.html#cb216-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb216-84"><a href="manipulación-y-agrupación-de-datos.html#cb216-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr (5): iata, airport, city, state, country</span></span>
<span id="cb216-85"><a href="manipulación-y-agrupación-de-datos.html#cb216-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl (2): lat, long</span></span>
<span id="cb216-86"><a href="manipulación-y-agrupación-de-datos.html#cb216-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb216-87"><a href="manipulación-y-agrupación-de-datos.html#cb216-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb216-88"><a href="manipulación-y-agrupación-de-datos.html#cb216-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb216-89"><a href="manipulación-y-agrupación-de-datos.html#cb216-89" aria-hidden="true" tabindex="-1"></a>airports</span>
<span id="cb216-90"><a href="manipulación-y-agrupación-de-datos.html#cb216-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3,376 × 7</span></span>
<span id="cb216-91"><a href="manipulación-y-agrupación-de-datos.html#cb216-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    iata  airport              city             state country   lat   long</span></span>
<span id="cb216-92"><a href="manipulación-y-agrupación-de-datos.html#cb216-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb216-93"><a href="manipulación-y-agrupación-de-datos.html#cb216-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 00M   Thigpen              Bay Springs      MS    USA      32.0  -89.2</span></span>
<span id="cb216-94"><a href="manipulación-y-agrupación-de-datos.html#cb216-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 00R   Livingston Municipal Livingston       TX    USA      30.7  -95.0</span></span>
<span id="cb216-95"><a href="manipulación-y-agrupación-de-datos.html#cb216-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 00V   Meadow Lake          Colorado Springs CO    USA      38.9 -105. </span></span>
<span id="cb216-96"><a href="manipulación-y-agrupación-de-datos.html#cb216-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 01G   Perry-Warsaw         Perry            NY    USA      42.7  -78.1</span></span>
<span id="cb216-97"><a href="manipulación-y-agrupación-de-datos.html#cb216-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 01J   Hilliard Airpark     Hilliard         FL    USA      30.7  -81.9</span></span>
<span id="cb216-98"><a href="manipulación-y-agrupación-de-datos.html#cb216-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 01M   Tishomingo County    Belmont          MS    USA      34.5  -88.2</span></span>
<span id="cb216-99"><a href="manipulación-y-agrupación-de-datos.html#cb216-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 02A   Gragg-Wade           Clanton          AL    USA      32.9  -86.6</span></span>
<span id="cb216-100"><a href="manipulación-y-agrupación-de-datos.html#cb216-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 02C   Capitol              Brookfield       WI    USA      43.1  -88.2</span></span>
<span id="cb216-101"><a href="manipulación-y-agrupación-de-datos.html#cb216-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 02G   Columbiana County    East Liverpool   OH    USA      40.7  -80.6</span></span>
<span id="cb216-102"><a href="manipulación-y-agrupación-de-datos.html#cb216-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 03D   Memphis Memorial     Memphis          MO    USA      40.4  -92.2</span></span>
<span id="cb216-103"><a href="manipulación-y-agrupación-de-datos.html#cb216-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3,366 more rows</span></span></code></pre></div>
</div>
<div id="filtrar" class="section level3 unnumbered hasAnchor">
<h3>Filtrar<a href="manipulación-y-agrupación-de-datos.html#filtrar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Creamos una base de datos de juguete para mostrar el funcionamiento de cada
instrucción:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="manipulación-y-agrupación-de-datos.html#cb217-1" aria-hidden="true" tabindex="-1"></a>df_ej <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">genero =</span> <span class="fu">c</span>(<span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;hombre&quot;</span>, <span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;hombre&quot;</span>), </span>
<span id="cb217-2"><a href="manipulación-y-agrupación-de-datos.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">estatura =</span> <span class="fu">c</span>(<span class="fl">1.65</span>, <span class="fl">1.80</span>, <span class="fl">1.70</span>, <span class="fl">1.60</span>, <span class="fl">1.67</span>))</span>
<span id="cb217-3"><a href="manipulación-y-agrupación-de-datos.html#cb217-3" aria-hidden="true" tabindex="-1"></a>df_ej</span>
<span id="cb217-4"><a href="manipulación-y-agrupación-de-datos.html#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb217-5"><a href="manipulación-y-agrupación-de-datos.html#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb217-6"><a href="manipulación-y-agrupación-de-datos.html#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb217-7"><a href="manipulación-y-agrupación-de-datos.html#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65</span></span>
<span id="cb217-8"><a href="manipulación-y-agrupación-de-datos.html#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.8 </span></span>
<span id="cb217-9"><a href="manipulación-y-agrupación-de-datos.html#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.7 </span></span>
<span id="cb217-10"><a href="manipulación-y-agrupación-de-datos.html#cb217-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.6 </span></span>
<span id="cb217-11"><a href="manipulación-y-agrupación-de-datos.html#cb217-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre     1.67</span></span></code></pre></div>
<p>El primer argumento de <code>filter()</code> es el nombre del <em>data frame</em>, los subsecuentes
son las expresiones que indican que filas filtrar.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="manipulación-y-agrupación-de-datos.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_ej, genero <span class="sc">==</span> <span class="st">&quot;mujer&quot;</span>)</span>
<span id="cb218-2"><a href="manipulación-y-agrupación-de-datos.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb218-3"><a href="manipulación-y-agrupación-de-datos.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb218-4"><a href="manipulación-y-agrupación-de-datos.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb218-5"><a href="manipulación-y-agrupación-de-datos.html#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65</span></span>
<span id="cb218-6"><a href="manipulación-y-agrupación-de-datos.html#cb218-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 mujer      1.7 </span></span>
<span id="cb218-7"><a href="manipulación-y-agrupación-de-datos.html#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.6</span></span>
<span id="cb218-8"><a href="manipulación-y-agrupación-de-datos.html#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_ej, estatura <span class="sc">&gt;</span> <span class="fl">1.65</span> <span class="sc">&amp;</span> estatura <span class="sc">&lt;</span> <span class="fl">1.75</span>)</span>
<span id="cb218-9"><a href="manipulación-y-agrupación-de-datos.html#cb218-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb218-10"><a href="manipulación-y-agrupación-de-datos.html#cb218-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb218-11"><a href="manipulación-y-agrupación-de-datos.html#cb218-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb218-12"><a href="manipulación-y-agrupación-de-datos.html#cb218-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.7 </span></span>
<span id="cb218-13"><a href="manipulación-y-agrupación-de-datos.html#cb218-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.67</span></span></code></pre></div>
<p>Algunos operadores importantes para filtrar son:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="manipulación-y-agrupación-de-datos.html#cb219-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb219-2"><a href="manipulación-y-agrupación-de-datos.html#cb219-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&gt;=</span> <span class="dv">1</span></span>
<span id="cb219-3"><a href="manipulación-y-agrupación-de-datos.html#cb219-3" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&lt;</span> <span class="dv">1</span></span>
<span id="cb219-4"><a href="manipulación-y-agrupación-de-datos.html#cb219-4" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&lt;=</span> <span class="dv">1</span></span>
<span id="cb219-5"><a href="manipulación-y-agrupación-de-datos.html#cb219-5" aria-hidden="true" tabindex="-1"></a>x <span class="sc">!=</span> <span class="dv">1</span></span>
<span id="cb219-6"><a href="manipulación-y-agrupación-de-datos.html#cb219-6" aria-hidden="true" tabindex="-1"></a>x <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb219-7"><a href="manipulación-y-agrupación-de-datos.html#cb219-7" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p>Debemos tener cuidado al usar <code>==</code></p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="manipulación-y-agrupación-de-datos.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span>
<span id="cb220-2"><a href="manipulación-y-agrupación-de-datos.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb220-3"><a href="manipulación-y-agrupación-de-datos.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span> <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb220-4"><a href="manipulación-y-agrupación-de-datos.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Los resultados de arriba se deben a que las computadoras
usan aritmética de precisión finita:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="manipulación-y-agrupación-de-datos.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span>, <span class="at">digits =</span> <span class="dv">20</span>)</span>
<span id="cb221-2"><a href="manipulación-y-agrupación-de-datos.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.99999999999999988898</span></span></code></pre></div>
<p>Para estos casos es útil usar la función <code>near()</code></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="manipulación-y-agrupación-de-datos.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="fu">sqrt</span>(<span class="dv">2</span>) <span class="sc">^</span> <span class="dv">2</span>,  <span class="dv">2</span>)</span>
<span id="cb222-2"><a href="manipulación-y-agrupación-de-datos.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb222-3"><a href="manipulación-y-agrupación-de-datos.html#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span>, <span class="dv">1</span>)</span>
<span id="cb222-4"><a href="manipulación-y-agrupación-de-datos.html#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Los operadores booleanos también son convenientes para
filtrar:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="manipulación-y-agrupación-de-datos.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conjuntos</span></span>
<span id="cb223-2"><a href="manipulación-y-agrupación-de-datos.html#cb223-2" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|</span> b</span>
<span id="cb223-3"><a href="manipulación-y-agrupación-de-datos.html#cb223-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">&amp;</span> b</span>
<span id="cb223-4"><a href="manipulación-y-agrupación-de-datos.html#cb223-4" aria-hidden="true" tabindex="-1"></a>a <span class="sc">&amp;</span> <span class="sc">!</span>b</span>
<span id="cb223-5"><a href="manipulación-y-agrupación-de-datos.html#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xor</span>(a, b)</span></code></pre></div>
<p>El siguiente esquema nos ayuda a entender que hace cada operación:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="manipulación-y-agrupación-de-datos.html#cb224-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;imagenes/transform-logical.png&quot;</span>)</span></code></pre></div>
<p><img src="imagenes/transform-logical.png" width="579" style="display: block; margin: auto;" /></p>
<p><img src="imagenes/manicule2.jpg" /> Encuentra todos los vuelos hacia SFO ó OAK.</p>
<p>            Los vuelos
con un retraso mayor a una hora.</p>
<p>            En los que
el retraso de llegada es más del doble que el retraso de salida.</p>
<p>Un caso común es cuando se desea eliminar los datos con faltantes en una o más
columnas de las tablas de datos, en R los datos faltantes se expresan como <code>NA</code>,
para eliminar los faltantes en la variable <code>dep_delay</code> resulta natural escribir:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="manipulación-y-agrupación-de-datos.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dep_delay <span class="sc">!=</span> <span class="cn">NA</span>)</span>
<span id="cb225-2"><a href="manipulación-y-agrupación-de-datos.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 0 × 14</span></span>
<span id="cb225-3"><a href="manipulación-y-agrupación-de-datos.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 14 variables: date &lt;dttm&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, dep &lt;dbl&gt;,</span></span>
<span id="cb225-4"><a href="manipulación-y-agrupación-de-datos.html#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   arr &lt;dbl&gt;, dep_delay &lt;dbl&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;dbl&gt;,</span></span>
<span id="cb225-5"><a href="manipulación-y-agrupación-de-datos.html#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dest &lt;chr&gt;, plane &lt;chr&gt;, cancelled &lt;dbl&gt;, time &lt;dbl&gt;, dist &lt;dbl&gt;</span></span></code></pre></div>
<p>que nos devuelve una tabla vacía, sin embargo, si hay faltantes en esta
variable. El problema resulta de usar el operador <code>!=</code>, pensemos ¿qué regresan
las siguientes expresiones?</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="manipulación-y-agrupación-de-datos.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">+</span> <span class="cn">NA</span></span>
<span id="cb226-2"><a href="manipulación-y-agrupación-de-datos.html#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb226-3"><a href="manipulación-y-agrupación-de-datos.html#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="cn">NA</span>))</span>
<span id="cb226-4"><a href="manipulación-y-agrupación-de-datos.html#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>,  <span class="cn">NA</span>))</span>
<span id="cb226-5"><a href="manipulación-y-agrupación-de-datos.html#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">&lt;</span> <span class="dv">3</span></span>
<span id="cb226-6"><a href="manipulación-y-agrupación-de-datos.html#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="dv">3</span></span>
<span id="cb226-7"><a href="manipulación-y-agrupación-de-datos.html#cb226-7" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<p>Las expresiones anteriores regresan <code>NA</code>, el hecho que la media de un vector
que incluye NAs o su suma regrese <code>NA</code>s se debe a que el default en R es
propagar los valores faltantes, esto es, si deconozco el valor de una de las
componentes de un vector, también desconozco la suma del mismo; sin embargo,
muchas funciones tienen un argumento <em>na.rm</em> para removerlos,</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="manipulación-y-agrupación-de-datos.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="cn">NA</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-2"><a href="manipulación-y-agrupación-de-datos.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 9</span></span>
<span id="cb227-3"><a href="manipulación-y-agrupación-de-datos.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="cn">NA</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-4"><a href="manipulación-y-agrupación-de-datos.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4.5</span></span></code></pre></div>
<p>Aún queda pendiente, como filtrarlos en una tabla, para esto veamos que el
manejo de datos faltantes en R utiliza una lógica ternaria (como SQL):</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="manipulación-y-agrupación-de-datos.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">NA</span></span>
<span id="cb228-2"><a href="manipulación-y-agrupación-de-datos.html#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>La expresión anterior puede resultar confusa, una manera de pensar en esto es
considerar los NA como <em>no sé</em>, por ejemplo si no se la edad de Juan y no se la
edad de Esteban, la respuesta a ¿Juan tiene la misma edad que Esteban? es
<em>no sé</em> (NA).</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="manipulación-y-agrupación-de-datos.html#cb229-1" aria-hidden="true" tabindex="-1"></a>edad_Juan <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb229-2"><a href="manipulación-y-agrupación-de-datos.html#cb229-2" aria-hidden="true" tabindex="-1"></a>edad_Esteban <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb229-3"><a href="manipulación-y-agrupación-de-datos.html#cb229-3" aria-hidden="true" tabindex="-1"></a>edad_Juan <span class="sc">==</span> edad_Esteban</span>
<span id="cb229-4"><a href="manipulación-y-agrupación-de-datos.html#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb229-5"><a href="manipulación-y-agrupación-de-datos.html#cb229-5" aria-hidden="true" tabindex="-1"></a>edad_Jose <span class="ot">&lt;-</span> <span class="dv">32</span></span>
<span id="cb229-6"><a href="manipulación-y-agrupación-de-datos.html#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Juan es menor que José?</span></span>
<span id="cb229-7"><a href="manipulación-y-agrupación-de-datos.html#cb229-7" aria-hidden="true" tabindex="-1"></a>edad_Juan <span class="sc">&lt;</span> edad_Jose</span>
<span id="cb229-8"><a href="manipulación-y-agrupación-de-datos.html#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>Por tanto para determinar si un valor es faltante usamos la instrucción
<code>is.na()</code>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="manipulación-y-agrupación-de-datos.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(<span class="cn">NA</span>)</span>
<span id="cb230-2"><a href="manipulación-y-agrupación-de-datos.html#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Y finalmente podemos filtrar con</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="manipulación-y-agrupación-de-datos.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, <span class="fu">is.na</span>(dep_delay))</span></code></pre></div>
</div>
<div id="seleccionar" class="section level3 unnumbered hasAnchor">
<h3>Seleccionar<a href="manipulación-y-agrupación-de-datos.html#seleccionar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Elegir columnas de un conjunto de datos.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="manipulación-y-agrupación-de-datos.html#cb232-1" aria-hidden="true" tabindex="-1"></a>df_ej</span>
<span id="cb232-2"><a href="manipulación-y-agrupación-de-datos.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb232-3"><a href="manipulación-y-agrupación-de-datos.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb232-4"><a href="manipulación-y-agrupación-de-datos.html#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb232-5"><a href="manipulación-y-agrupación-de-datos.html#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65</span></span>
<span id="cb232-6"><a href="manipulación-y-agrupación-de-datos.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.8 </span></span>
<span id="cb232-7"><a href="manipulación-y-agrupación-de-datos.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.7 </span></span>
<span id="cb232-8"><a href="manipulación-y-agrupación-de-datos.html#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.6 </span></span>
<span id="cb232-9"><a href="manipulación-y-agrupación-de-datos.html#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre     1.67</span></span>
<span id="cb232-10"><a href="manipulación-y-agrupación-de-datos.html#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_ej, genero)</span>
<span id="cb232-11"><a href="manipulación-y-agrupación-de-datos.html#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 1</span></span>
<span id="cb232-12"><a href="manipulación-y-agrupación-de-datos.html#cb232-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero</span></span>
<span id="cb232-13"><a href="manipulación-y-agrupación-de-datos.html#cb232-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span id="cb232-14"><a href="manipulación-y-agrupación-de-datos.html#cb232-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer </span></span>
<span id="cb232-15"><a href="manipulación-y-agrupación-de-datos.html#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre</span></span>
<span id="cb232-16"><a href="manipulación-y-agrupación-de-datos.html#cb232-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer </span></span>
<span id="cb232-17"><a href="manipulación-y-agrupación-de-datos.html#cb232-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer </span></span>
<span id="cb232-18"><a href="manipulación-y-agrupación-de-datos.html#cb232-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre</span></span>
<span id="cb232-19"><a href="manipulación-y-agrupación-de-datos.html#cb232-19" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_ej, <span class="sc">-</span>genero)</span>
<span id="cb232-20"><a href="manipulación-y-agrupación-de-datos.html#cb232-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 1</span></span>
<span id="cb232-21"><a href="manipulación-y-agrupación-de-datos.html#cb232-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   estatura</span></span>
<span id="cb232-22"><a href="manipulación-y-agrupación-de-datos.html#cb232-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;</span></span>
<span id="cb232-23"><a href="manipulación-y-agrupación-de-datos.html#cb232-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1.65</span></span>
<span id="cb232-24"><a href="manipulación-y-agrupación-de-datos.html#cb232-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1.8 </span></span>
<span id="cb232-25"><a href="manipulación-y-agrupación-de-datos.html#cb232-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1.7 </span></span>
<span id="cb232-26"><a href="manipulación-y-agrupación-de-datos.html#cb232-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     1.6 </span></span>
<span id="cb232-27"><a href="manipulación-y-agrupación-de-datos.html#cb232-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     1.67</span></span></code></pre></div>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="manipulación-y-agrupación-de-datos.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_ej, <span class="fu">starts_with</span>(<span class="st">&quot;g&quot;</span>))</span>
<span id="cb233-2"><a href="manipulación-y-agrupación-de-datos.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_ej, <span class="fu">contains</span>(<span class="st">&quot;g&quot;</span>))</span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> Ve la ayuda de select (<code>?select</code>) y escribe tres
maneras de seleccionar las variables de retraso (delay).</p>
</div>
<div id="ordenar" class="section level3 unnumbered hasAnchor">
<h3>Ordenar<a href="manipulación-y-agrupación-de-datos.html#ordenar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ordenar de acuerdo al valor de una o más variables:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="manipulación-y-agrupación-de-datos.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_ej, genero)</span>
<span id="cb234-2"><a href="manipulación-y-agrupación-de-datos.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb234-3"><a href="manipulación-y-agrupación-de-datos.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb234-4"><a href="manipulación-y-agrupación-de-datos.html#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb234-5"><a href="manipulación-y-agrupación-de-datos.html#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 hombre     1.8 </span></span>
<span id="cb234-6"><a href="manipulación-y-agrupación-de-datos.html#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.67</span></span>
<span id="cb234-7"><a href="manipulación-y-agrupación-de-datos.html#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.65</span></span>
<span id="cb234-8"><a href="manipulación-y-agrupación-de-datos.html#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.7 </span></span>
<span id="cb234-9"><a href="manipulación-y-agrupación-de-datos.html#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 mujer      1.6</span></span>
<span id="cb234-10"><a href="manipulación-y-agrupación-de-datos.html#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_ej, <span class="fu">desc</span>(estatura))</span>
<span id="cb234-11"><a href="manipulación-y-agrupación-de-datos.html#cb234-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb234-12"><a href="manipulación-y-agrupación-de-datos.html#cb234-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb234-13"><a href="manipulación-y-agrupación-de-datos.html#cb234-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb234-14"><a href="manipulación-y-agrupación-de-datos.html#cb234-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 hombre     1.8 </span></span>
<span id="cb234-15"><a href="manipulación-y-agrupación-de-datos.html#cb234-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 mujer      1.7 </span></span>
<span id="cb234-16"><a href="manipulación-y-agrupación-de-datos.html#cb234-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 hombre     1.67</span></span>
<span id="cb234-17"><a href="manipulación-y-agrupación-de-datos.html#cb234-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.65</span></span>
<span id="cb234-18"><a href="manipulación-y-agrupación-de-datos.html#cb234-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 mujer      1.6</span></span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> Ordena los vuelos por fecha de salida y hora.</p>
<p>            ¿Cuáles
son los vuelos con mayor retraso?</p>
<p>            ¿Qué vuelos
<em>ganaron</em> más tiempo en el aire?</p>
</div>
<div id="mutar" class="section level3 unnumbered hasAnchor">
<h3>Mutar<a href="manipulación-y-agrupación-de-datos.html#mutar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Mutar consiste en crear nuevas variables aplicando una función a columnas
existentes:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="manipulación-y-agrupación-de-datos.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(df_ej, <span class="at">estatura_cm =</span> estatura <span class="sc">*</span> <span class="dv">100</span>) </span>
<span id="cb235-2"><a href="manipulación-y-agrupación-de-datos.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb235-3"><a href="manipulación-y-agrupación-de-datos.html#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura estatura_cm</span></span>
<span id="cb235-4"><a href="manipulación-y-agrupación-de-datos.html#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb235-5"><a href="manipulación-y-agrupación-de-datos.html#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65         165</span></span>
<span id="cb235-6"><a href="manipulación-y-agrupación-de-datos.html#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.8          180</span></span>
<span id="cb235-7"><a href="manipulación-y-agrupación-de-datos.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.7          170</span></span>
<span id="cb235-8"><a href="manipulación-y-agrupación-de-datos.html#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.6          160</span></span>
<span id="cb235-9"><a href="manipulación-y-agrupación-de-datos.html#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre     1.67         167</span></span>
<span id="cb235-10"><a href="manipulación-y-agrupación-de-datos.html#cb235-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(df_ej, <span class="at">estatura_cm =</span> estatura <span class="sc">*</span> <span class="dv">100</span>, <span class="at">estatura_in =</span> estatura_cm <span class="sc">*</span> <span class="fl">0.3937</span>) </span>
<span id="cb235-11"><a href="manipulación-y-agrupación-de-datos.html#cb235-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span id="cb235-12"><a href="manipulación-y-agrupación-de-datos.html#cb235-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura estatura_cm estatura_in</span></span>
<span id="cb235-13"><a href="manipulación-y-agrupación-de-datos.html#cb235-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb235-14"><a href="manipulación-y-agrupación-de-datos.html#cb235-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65         165        65.0</span></span>
<span id="cb235-15"><a href="manipulación-y-agrupación-de-datos.html#cb235-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.8          180        70.9</span></span>
<span id="cb235-16"><a href="manipulación-y-agrupación-de-datos.html#cb235-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.7          170        66.9</span></span>
<span id="cb235-17"><a href="manipulación-y-agrupación-de-datos.html#cb235-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.6          160        63.0</span></span>
<span id="cb235-18"><a href="manipulación-y-agrupación-de-datos.html#cb235-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre     1.67         167        65.7</span></span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> Calcula la velocidad en millas por hora a partir de
la variable tiempo y la distancia (en millas). ¿Quá vuelo fue el más rápido?</p>
<p>            Crea una nueva
variable que muestre cuánto tiempo se ganó o perdió durante el vuelo.</p>
<p>Hay muchas funciones que podemos usar para crear nuevas variables con <code>mutate()</code>, éstas deben cumplir ser funciones vectorizadas, es decir, reciben un vector de valores y devuelven un vector de la misma dimensión.</p>
</div>
<div id="summarise-y-resúmenes-por-grupo" class="section level3 unnumbered hasAnchor">
<h3>Summarise y resúmenes por grupo<a href="manipulación-y-agrupación-de-datos.html#summarise-y-resúmenes-por-grupo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Summarise sirve para crear nuevas bases de datos con resúmenes o agregaciones de
los datos originales.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="manipulación-y-agrupación-de-datos.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(df_ej, <span class="at">promedio =</span> <span class="fu">mean</span>(estatura))</span>
<span id="cb236-2"><a href="manipulación-y-agrupación-de-datos.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb236-3"><a href="manipulación-y-agrupación-de-datos.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   promedio</span></span>
<span id="cb236-4"><a href="manipulación-y-agrupación-de-datos.html#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;</span></span>
<span id="cb236-5"><a href="manipulación-y-agrupación-de-datos.html#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1.68</span></span></code></pre></div>
<p>Podemos hacer resúmenes por grupo, primero creamos una base de datos agrupada:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="manipulación-y-agrupación-de-datos.html#cb237-1" aria-hidden="true" tabindex="-1"></a>by_genero <span class="ot">&lt;-</span> <span class="fu">group_by</span>(df_ej, genero)</span>
<span id="cb237-2"><a href="manipulación-y-agrupación-de-datos.html#cb237-2" aria-hidden="true" tabindex="-1"></a>by_genero</span>
<span id="cb237-3"><a href="manipulación-y-agrupación-de-datos.html#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb237-4"><a href="manipulación-y-agrupación-de-datos.html#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   genero [2]</span></span>
<span id="cb237-5"><a href="manipulación-y-agrupación-de-datos.html#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero estatura</span></span>
<span id="cb237-6"><a href="manipulación-y-agrupación-de-datos.html#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb237-7"><a href="manipulación-y-agrupación-de-datos.html#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mujer      1.65</span></span>
<span id="cb237-8"><a href="manipulación-y-agrupación-de-datos.html#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hombre     1.8 </span></span>
<span id="cb237-9"><a href="manipulación-y-agrupación-de-datos.html#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 mujer      1.7 </span></span>
<span id="cb237-10"><a href="manipulación-y-agrupación-de-datos.html#cb237-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 mujer      1.6 </span></span>
<span id="cb237-11"><a href="manipulación-y-agrupación-de-datos.html#cb237-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hombre     1.67</span></span></code></pre></div>
<p>y después operamos sobre cada grupo, creando un resumen a nivel grupo y uniendo
los subconjuntos en una base nueva:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="manipulación-y-agrupación-de-datos.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(by_genero, <span class="at">promedio =</span> <span class="fu">mean</span>(estatura))</span>
<span id="cb238-2"><a href="manipulación-y-agrupación-de-datos.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb238-3"><a href="manipulación-y-agrupación-de-datos.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genero promedio</span></span>
<span id="cb238-4"><a href="manipulación-y-agrupación-de-datos.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb238-5"><a href="manipulación-y-agrupación-de-datos.html#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 hombre     1.74</span></span>
<span id="cb238-6"><a href="manipulación-y-agrupación-de-datos.html#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 mujer      1.65</span></span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> Calcula el retraso promedio por fecha.</p>
<p>            ¿Qué otros
resúmenes puedes hacer para explorar el retraso por fecha?</p>
<ul>
<li>Algunas funciones útiles con <em>summarise</em> son min(x), median(x), max(x),
quantile(x, p), n(), sum(x), sum(x &gt; 1), mean(x &gt; 1), sd(x).</li>
</ul>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="manipulación-y-agrupación-de-datos.html#cb239-1" aria-hidden="true" tabindex="-1"></a>flights<span class="sc">$</span>date_only <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(flights<span class="sc">$</span>date)</span>
<span id="cb239-2"><a href="manipulación-y-agrupación-de-datos.html#cb239-2" aria-hidden="true" tabindex="-1"></a>by_date <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, date_only)</span>
<span id="cb239-3"><a href="manipulación-y-agrupación-de-datos.html#cb239-3" aria-hidden="true" tabindex="-1"></a>no_miss <span class="ot">&lt;-</span> <span class="fu">filter</span>(by_date, <span class="sc">!</span><span class="fu">is.na</span>(dep))</span>
<span id="cb239-4"><a href="manipulación-y-agrupación-de-datos.html#cb239-4" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> <span class="fu">summarise</span>(no_miss, <span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay), <span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
</div>
<div id="operador-pipeline" class="section level3 unnumbered hasAnchor">
<h3>Operador pipeline<a href="manipulación-y-agrupación-de-datos.html#operador-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En R cuando uno hace varias operaciones es difícil leer y entender el código:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="manipulación-y-agrupación-de-datos.html#cb240-1" aria-hidden="true" tabindex="-1"></a>hourly_delay <span class="ot">&lt;-</span> <span class="fu">filter</span>(<span class="fu">summarise</span>(<span class="fu">group_by</span>(<span class="fu">filter</span>(flights, <span class="sc">!</span><span class="fu">is.na</span>(dep_delay)), </span>
<span id="cb240-2"><a href="manipulación-y-agrupación-de-datos.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  date_only, hour), <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay), <span class="at">n =</span> <span class="fu">n</span>()), n <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb240-3"><a href="manipulación-y-agrupación-de-datos.html#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;date_only&#39;. You can override using the</span></span>
<span id="cb240-4"><a href="manipulación-y-agrupación-de-datos.html#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
<p>La dificultad radica en que usualmente los parámetros se asignan después del
nombre de la función usando (). El operador <em>Forward Pipe</em> (<code>%&gt;%) cambia este  orden, de manera que un parámetro que precede a la función es enviado ("piped")  a la función:</code>x %&gt;% f(y)<code>se vuelve</code>f(x,y)<code>,</code>x %&gt;% f(y) %&gt;% g(z)<code>se vuelve</code>g(f(x, y), z)`. Es así que podemos reescribir el código para poder leer las
operaciones que vamos aplicando de izquierda a derecha
y de arriba hacia abajo.
Veamos como cambia el código anterior:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="manipulación-y-agrupación-de-datos.html#cb241-1" aria-hidden="true" tabindex="-1"></a>hourly_delay <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="manipulación-y-agrupación-de-datos.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="manipulación-y-agrupación-de-datos.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_only, hour) <span class="sc">%&gt;%</span></span>
<span id="cb241-4"><a href="manipulación-y-agrupación-de-datos.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">delay =</span> <span class="fu">mean</span>(dep_delay), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb241-5"><a href="manipulación-y-agrupación-de-datos.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb241-6"><a href="manipulación-y-agrupación-de-datos.html#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;date_only&#39;. You can override using the</span></span>
<span id="cb241-7"><a href="manipulación-y-agrupación-de-datos.html#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
<p>podemos leer %&gt;% como “<em>después</em>”.</p>
<p><img src="imagenes/manicule2.jpg" /> ¿Qué destinos tienen el promedio de retrasos más
alto?</p>
<p>            ¿Qué vuelos
(compañía + vuelo) ocurren diario?</p>
<p>            En promedio,
¿Cómo varían a lo largo del día los retrasos de vuelos no cancelados? (pista: hour +
minute / 60)</p>
</div>
<div id="variables-por-grupo" class="section level3 unnumbered hasAnchor">
<h3>Variables por grupo<a href="manipulación-y-agrupación-de-datos.html#variables-por-grupo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En ocasiones es conveniente crear variables por grupo, por ejemplo estandarizar
dentro de cada grupo z = (x - mean(x)) / sd(x).</p>
<p>Veamos un ejemplo:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="manipulación-y-agrupación-de-datos.html#cb242-1" aria-hidden="true" tabindex="-1"></a>planes <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb242-2"><a href="manipulación-y-agrupación-de-datos.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="manipulación-y-agrupación-de-datos.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(plane) <span class="sc">%&gt;%</span></span>
<span id="cb242-4"><a href="manipulación-y-agrupación-de-datos.html#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">30</span>)</span>
<span id="cb242-5"><a href="manipulación-y-agrupación-de-datos.html#cb242-5" aria-hidden="true" tabindex="-1"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb242-6"><a href="manipulación-y-agrupación-de-datos.html#cb242-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_delay =</span></span>
<span id="cb242-7"><a href="manipulación-y-agrupación-de-datos.html#cb242-7" aria-hidden="true" tabindex="-1"></a>    (arr_delay <span class="sc">-</span> <span class="fu">mean</span>(arr_delay)) <span class="sc">/</span> <span class="fu">sd</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb242-8"><a href="manipulación-y-agrupación-de-datos.html#cb242-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(z_delay <span class="sc">&gt;</span> <span class="dv">5</span>)</span>
<span id="cb242-9"><a href="manipulación-y-agrupación-de-datos.html#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,403 × 16</span></span>
<span id="cb242-10"><a href="manipulación-y-agrupación-de-datos.html#cb242-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   plane [856]</span></span>
<span id="cb242-11"><a href="manipulación-y-agrupación-de-datos.html#cb242-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    date                 hour minute   dep   arr dep_delay arr_d…¹ carrier flight</span></span>
<span id="cb242-12"><a href="manipulación-y-agrupación-de-datos.html#cb242-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dttm&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span id="cb242-13"><a href="manipulación-y-agrupación-de-datos.html#cb242-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2011-01-28 12:00:00    15     16  1516  1916       351     326 CO           1</span></span>
<span id="cb242-14"><a href="manipulación-y-agrupación-de-datos.html#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2011-01-27 12:00:00    18     22  1822  1945       234     210 CO         137</span></span>
<span id="cb242-15"><a href="manipulación-y-agrupación-de-datos.html#cb242-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2011-01-27 12:00:00    21     37  2137  2254       242     219 CO         150</span></span>
<span id="cb242-16"><a href="manipulación-y-agrupación-de-datos.html#cb242-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2011-01-27 12:00:00     0     11    11   216       168     137 CO         209</span></span>
<span id="cb242-17"><a href="manipulación-y-agrupación-de-datos.html#cb242-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2011-01-27 12:00:00    22     37  2237   153       227     208 CO         250</span></span>
<span id="cb242-18"><a href="manipulación-y-agrupación-de-datos.html#cb242-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2011-01-27 12:00:00    21     28  2128   136       231     216 CO        1632</span></span>
<span id="cb242-19"><a href="manipulación-y-agrupación-de-datos.html#cb242-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2011-01-26 12:00:00    11     46  1146  1633       171     193 CO         510</span></span>
<span id="cb242-20"><a href="manipulación-y-agrupación-de-datos.html#cb242-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2011-01-26 12:00:00     9     49   949  1436       144     180 CO         776</span></span>
<span id="cb242-21"><a href="manipulación-y-agrupación-de-datos.html#cb242-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2011-01-21 12:00:00    19     11  1911  2352        94     112 CO        1632</span></span>
<span id="cb242-22"><a href="manipulación-y-agrupación-de-datos.html#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2011-01-20 12:00:00     6     35   635   807       780     775 CO          59</span></span>
<span id="cb242-23"><a href="manipulación-y-agrupación-de-datos.html#cb242-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,393 more rows, 7 more variables: dest &lt;chr&gt;, plane &lt;chr&gt;,</span></span>
<span id="cb242-24"><a href="manipulación-y-agrupación-de-datos.html#cb242-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   cancelled &lt;dbl&gt;, time &lt;dbl&gt;, dist &lt;dbl&gt;, date_only &lt;date&gt;, z_delay &lt;dbl&gt;,</span></span>
<span id="cb242-25"><a href="manipulación-y-agrupación-de-datos.html#cb242-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   and abbreviated variable name ¹​arr_delay</span></span></code></pre></div>
</div>
<div id="verbos-de-dos-tablas" class="section level3 unnumbered hasAnchor">
<h3>Verbos de dos tablas<a href="manipulación-y-agrupación-de-datos.html#verbos-de-dos-tablas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>¿Cómo mostramos los retrasos de los vuelos en un mapa?</p>
<p>Para responder esta pregunta necesitamos unir la base de datos de vuelos
con la de aeropuertos.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="manipulación-y-agrupación-de-datos.html#cb243-1" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="manipulación-y-agrupación-de-datos.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">dest =</span> iata, <span class="at">name =</span> airport, lat, long)</span>
<span id="cb243-3"><a href="manipulación-y-agrupación-de-datos.html#cb243-3" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="manipulación-y-agrupación-de-datos.html#cb243-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="manipulación-y-agrupación-de-datos.html#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb243-6"><a href="manipulación-y-agrupación-de-datos.html#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb243-7"><a href="manipulación-y-agrupación-de-datos.html#cb243-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">arr_delay =</span> <span class="fu">mean</span>(arr_delay),</span>
<span id="cb243-8"><a href="manipulación-y-agrupación-de-datos.html#cb243-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> <span class="fu">n</span>() ) <span class="sc">%&gt;%</span></span>
<span id="cb243-9"><a href="manipulación-y-agrupación-de-datos.html#cb243-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb243-10"><a href="manipulación-y-agrupación-de-datos.html#cb243-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(location)</span>
<span id="cb243-11"><a href="manipulación-y-agrupación-de-datos.html#cb243-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;dest&quot;</span></span>
<span id="cb243-12"><a href="manipulación-y-agrupación-de-datos.html#cb243-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 116 × 6</span></span>
<span id="cb243-13"><a href="manipulación-y-agrupación-de-datos.html#cb243-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    dest  arr_delay     n name                                  lat   long</span></span>
<span id="cb243-14"><a href="manipulación-y-agrupación-de-datos.html#cb243-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;                               &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb243-15"><a href="manipulación-y-agrupación-de-datos.html#cb243-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ANC        26.1   124 Ted Stevens Anchorage International  61.2 -150. </span></span>
<span id="cb243-16"><a href="manipulación-y-agrupación-de-datos.html#cb243-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 CID        17.8   406 Eastern Iowa                         41.9  -91.7</span></span>
<span id="cb243-17"><a href="manipulación-y-agrupación-de-datos.html#cb243-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 DSM        16.0   634 Des Moines International             41.5  -93.7</span></span>
<span id="cb243-18"><a href="manipulación-y-agrupación-de-datos.html#cb243-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 SFO        14.9  2800 San Francisco International          37.6 -122. </span></span>
<span id="cb243-19"><a href="manipulación-y-agrupación-de-datos.html#cb243-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 BPT        14.3     3 Southeast Texas Regional             30.0  -94.0</span></span>
<span id="cb243-20"><a href="manipulación-y-agrupación-de-datos.html#cb243-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 GRR        13.7   665 Kent County International            42.9  -85.5</span></span>
<span id="cb243-21"><a href="manipulación-y-agrupación-de-datos.html#cb243-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 DAY        13.7   444 James M Cox Dayton Intl              39.9  -84.2</span></span>
<span id="cb243-22"><a href="manipulación-y-agrupación-de-datos.html#cb243-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 VPS        12.5   864 Eglin Air Force Base                 30.5  -86.5</span></span>
<span id="cb243-23"><a href="manipulación-y-agrupación-de-datos.html#cb243-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 ECP        12.4   720 &lt;NA&gt;                                 NA     NA  </span></span>
<span id="cb243-24"><a href="manipulación-y-agrupación-de-datos.html#cb243-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 SAV        12.3   851 Savannah International               32.1  -81.2</span></span>
<span id="cb243-25"><a href="manipulación-y-agrupación-de-datos.html#cb243-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 106 more rows</span></span></code></pre></div>
<p>Hay varias maneras de unir dos bases de datos y debemos pensar en el
obejtivo:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="manipulación-y-agrupación-de-datos.html#cb244-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>, <span class="st">&quot;Stuart&quot;</span>, <span class="st">&quot;Pete&quot;</span>),</span>
<span id="cb244-2"><a href="manipulación-y-agrupación-de-datos.html#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">instrument =</span> <span class="fu">c</span>(<span class="st">&quot;guitar&quot;</span>, <span class="st">&quot;bass&quot;</span>, <span class="st">&quot;guitar&quot;</span>, <span class="st">&quot;drums&quot;</span>, <span class="st">&quot;bass&quot;</span>,</span>
<span id="cb244-3"><a href="manipulación-y-agrupación-de-datos.html#cb244-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">&quot;drums&quot;</span>))</span>
<span id="cb244-4"><a href="manipulación-y-agrupación-de-datos.html#cb244-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>, <span class="st">&quot;Brian&quot;</span>),</span>
<span id="cb244-5"><a href="manipulación-y-agrupación-de-datos.html#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">band =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;TRUE&quot;</span>,  <span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>))</span>
<span id="cb244-6"><a href="manipulación-y-agrupación-de-datos.html#cb244-6" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb244-7"><a href="manipulación-y-agrupación-de-datos.html#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb244-8"><a href="manipulación-y-agrupación-de-datos.html#cb244-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   instrument</span></span>
<span id="cb244-9"><a href="manipulación-y-agrupación-de-datos.html#cb244-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb244-10"><a href="manipulación-y-agrupación-de-datos.html#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John   guitar    </span></span>
<span id="cb244-11"><a href="manipulación-y-agrupación-de-datos.html#cb244-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Paul   bass      </span></span>
<span id="cb244-12"><a href="manipulación-y-agrupación-de-datos.html#cb244-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 George guitar    </span></span>
<span id="cb244-13"><a href="manipulación-y-agrupación-de-datos.html#cb244-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Ringo  drums     </span></span>
<span id="cb244-14"><a href="manipulación-y-agrupación-de-datos.html#cb244-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Stuart bass      </span></span>
<span id="cb244-15"><a href="manipulación-y-agrupación-de-datos.html#cb244-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Pete   drums</span></span>
<span id="cb244-16"><a href="manipulación-y-agrupación-de-datos.html#cb244-16" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb244-17"><a href="manipulación-y-agrupación-de-datos.html#cb244-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb244-18"><a href="manipulación-y-agrupación-de-datos.html#cb244-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   band </span></span>
<span id="cb244-19"><a href="manipulación-y-agrupación-de-datos.html#cb244-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;</span></span>
<span id="cb244-20"><a href="manipulación-y-agrupación-de-datos.html#cb244-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John   TRUE </span></span>
<span id="cb244-21"><a href="manipulación-y-agrupación-de-datos.html#cb244-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Paul   TRUE </span></span>
<span id="cb244-22"><a href="manipulación-y-agrupación-de-datos.html#cb244-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 George TRUE </span></span>
<span id="cb244-23"><a href="manipulación-y-agrupación-de-datos.html#cb244-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Ringo  TRUE </span></span>
<span id="cb244-24"><a href="manipulación-y-agrupación-de-datos.html#cb244-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Brian  FALSE</span></span>
<span id="cb244-25"><a href="manipulación-y-agrupación-de-datos.html#cb244-25" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(x, y)</span>
<span id="cb244-26"><a href="manipulación-y-agrupación-de-datos.html#cb244-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;name&quot;</span></span>
<span id="cb244-27"><a href="manipulación-y-agrupación-de-datos.html#cb244-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb244-28"><a href="manipulación-y-agrupación-de-datos.html#cb244-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   instrument band </span></span>
<span id="cb244-29"><a href="manipulación-y-agrupación-de-datos.html#cb244-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;</span></span>
<span id="cb244-30"><a href="manipulación-y-agrupación-de-datos.html#cb244-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John   guitar     TRUE </span></span>
<span id="cb244-31"><a href="manipulación-y-agrupación-de-datos.html#cb244-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Paul   bass       TRUE </span></span>
<span id="cb244-32"><a href="manipulación-y-agrupación-de-datos.html#cb244-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 George guitar     TRUE </span></span>
<span id="cb244-33"><a href="manipulación-y-agrupación-de-datos.html#cb244-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Ringo  drums      TRUE</span></span>
<span id="cb244-34"><a href="manipulación-y-agrupación-de-datos.html#cb244-34" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(x, y)</span>
<span id="cb244-35"><a href="manipulación-y-agrupación-de-datos.html#cb244-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;name&quot;</span></span>
<span id="cb244-36"><a href="manipulación-y-agrupación-de-datos.html#cb244-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb244-37"><a href="manipulación-y-agrupación-de-datos.html#cb244-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   instrument band </span></span>
<span id="cb244-38"><a href="manipulación-y-agrupación-de-datos.html#cb244-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;</span></span>
<span id="cb244-39"><a href="manipulación-y-agrupación-de-datos.html#cb244-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John   guitar     TRUE </span></span>
<span id="cb244-40"><a href="manipulación-y-agrupación-de-datos.html#cb244-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Paul   bass       TRUE </span></span>
<span id="cb244-41"><a href="manipulación-y-agrupación-de-datos.html#cb244-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 George guitar     TRUE </span></span>
<span id="cb244-42"><a href="manipulación-y-agrupación-de-datos.html#cb244-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Ringo  drums      TRUE </span></span>
<span id="cb244-43"><a href="manipulación-y-agrupación-de-datos.html#cb244-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Stuart bass       &lt;NA&gt; </span></span>
<span id="cb244-44"><a href="manipulación-y-agrupación-de-datos.html#cb244-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Pete   drums      &lt;NA&gt;</span></span>
<span id="cb244-45"><a href="manipulación-y-agrupación-de-datos.html#cb244-45" aria-hidden="true" tabindex="-1"></a><span class="fu">semi_join</span>(x, y)</span>
<span id="cb244-46"><a href="manipulación-y-agrupación-de-datos.html#cb244-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;name&quot;</span></span>
<span id="cb244-47"><a href="manipulación-y-agrupación-de-datos.html#cb244-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb244-48"><a href="manipulación-y-agrupación-de-datos.html#cb244-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   instrument</span></span>
<span id="cb244-49"><a href="manipulación-y-agrupación-de-datos.html#cb244-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb244-50"><a href="manipulación-y-agrupación-de-datos.html#cb244-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John   guitar    </span></span>
<span id="cb244-51"><a href="manipulación-y-agrupación-de-datos.html#cb244-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Paul   bass      </span></span>
<span id="cb244-52"><a href="manipulación-y-agrupación-de-datos.html#cb244-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 George guitar    </span></span>
<span id="cb244-53"><a href="manipulación-y-agrupación-de-datos.html#cb244-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Ringo  drums</span></span>
<span id="cb244-54"><a href="manipulación-y-agrupación-de-datos.html#cb244-54" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(x, y)</span>
<span id="cb244-55"><a href="manipulación-y-agrupación-de-datos.html#cb244-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;name&quot;</span></span>
<span id="cb244-56"><a href="manipulación-y-agrupación-de-datos.html#cb244-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb244-57"><a href="manipulación-y-agrupación-de-datos.html#cb244-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name   instrument</span></span>
<span id="cb244-58"><a href="manipulación-y-agrupación-de-datos.html#cb244-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb244-59"><a href="manipulación-y-agrupación-de-datos.html#cb244-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stuart bass      </span></span>
<span id="cb244-60"><a href="manipulación-y-agrupación-de-datos.html#cb244-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Pete   drums</span></span></code></pre></div>
<p>Resumamos lo que observamos arriba:</p>
<div class="mi-tabla">
<table>
<thead>
<tr class="header">
<th>Tipo</th>
<th>Acción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inner</td>
<td>Incluye únicamente las filas que aparecen tanto en x como en y</td>
</tr>
<tr class="even">
<td>left</td>
<td>Incluye todas las filas en x y las filas de y que coincidan</td>
</tr>
<tr class="odd">
<td>semi</td>
<td>Incluye las filas de x que coincidan con y</td>
</tr>
<tr class="even">
<td>anti</td>
<td>Incluye las filas de x que no coinciden con y</td>
</tr>
</tbody>
</table>
</div>
<p>Ahora combinamos datos a nivel hora con condiciones climáticas, ¿cuál es el tipo
de unión adecuado?</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="manipulación-y-agrupación-de-datos.html#cb245-1" aria-hidden="true" tabindex="-1"></a>hourly_delay <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="manipulación-y-agrupación-de-datos.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_only, hour) <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="manipulación-y-agrupación-de-datos.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb245-4"><a href="manipulación-y-agrupación-de-datos.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb245-5"><a href="manipulación-y-agrupación-de-datos.html#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay),</span>
<span id="cb245-6"><a href="manipulación-y-agrupación-de-datos.html#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>() ) <span class="sc">%&gt;%</span></span>
<span id="cb245-7"><a href="manipulación-y-agrupación-de-datos.html#cb245-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb245-8"><a href="manipulación-y-agrupación-de-datos.html#cb245-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;date_only&#39;. You can override using the</span></span>
<span id="cb245-9"><a href="manipulación-y-agrupación-de-datos.html#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb245-10"><a href="manipulación-y-agrupación-de-datos.html#cb245-10" aria-hidden="true" tabindex="-1"></a>delay_weather <span class="ot">&lt;-</span> hourly_delay <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(weather)</span>
<span id="cb245-11"><a href="manipulación-y-agrupación-de-datos.html#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining, by = &quot;hour&quot;</span></span>
<span id="cb245-12"><a href="manipulación-y-agrupación-de-datos.html#cb245-12" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(delay_weather, <span class="sc">-</span>delay)</span>
<span id="cb245-13"><a href="manipulación-y-agrupación-de-datos.html#cb245-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,091,842 × 17</span></span>
<span id="cb245-14"><a href="manipulación-y-agrupación-de-datos.html#cb245-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   date_only [365]</span></span>
<span id="cb245-15"><a href="manipulación-y-agrupación-de-datos.html#cb245-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    date_only   hour delay     n date        temp dew_p…¹ humid…² press…³ visib…⁴</span></span>
<span id="cb245-16"><a href="manipulación-y-agrupación-de-datos.html#cb245-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb245-17"><a href="manipulación-y-agrupación-de-datos.html#cb245-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2011-05-12    23  184.    33 2011-01-02  43      28.9      58    30.3      10</span></span>
<span id="cb245-18"><a href="manipulación-y-agrupación-de-datos.html#cb245-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2011-05-12    23  184.    33 2011-01-03  39      27        62    30.3      10</span></span>
<span id="cb245-19"><a href="manipulación-y-agrupación-de-datos.html#cb245-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2011-05-12    23  184.    33 2011-01-04  50      45        83    30.1      10</span></span>
<span id="cb245-20"><a href="manipulación-y-agrupación-de-datos.html#cb245-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2011-05-12    23  184.    33 2011-01-05  62.6    60.8      94    30.0       5</span></span>
<span id="cb245-21"><a href="manipulación-y-agrupación-de-datos.html#cb245-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2011-05-12    23  184.    33 2011-01-06  53.1    36        52    30.0      10</span></span>
<span id="cb245-22"><a href="manipulación-y-agrupación-de-datos.html#cb245-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2011-05-12    23  184.    33 2011-01-07  46.9    36        66    30.0      10</span></span>
<span id="cb245-23"><a href="manipulación-y-agrupación-de-datos.html#cb245-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2011-05-12    23  184.    33 2011-01-08  50      43        77    29.9      10</span></span>
<span id="cb245-24"><a href="manipulación-y-agrupación-de-datos.html#cb245-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2011-05-12    23  184.    33 2011-01-09  53.1    30        41    29.9      10</span></span>
<span id="cb245-25"><a href="manipulación-y-agrupación-de-datos.html#cb245-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2011-05-12    23  184.    33 2011-01-10  41      37        86    30.0      10</span></span>
<span id="cb245-26"><a href="manipulación-y-agrupación-de-datos.html#cb245-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2011-05-12    23  184.    33 2011-01-11  39.9    32        73    30.3      10</span></span>
<span id="cb245-27"><a href="manipulación-y-agrupación-de-datos.html#cb245-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2,091,832 more rows, 7 more variables: wind_dir &lt;chr&gt;,</span></span>
<span id="cb245-28"><a href="manipulación-y-agrupación-de-datos.html#cb245-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wind_dir2 &lt;dbl&gt;, wind_speed &lt;dbl&gt;, gust_speed &lt;dbl&gt;, precip &lt;dbl&gt;,</span></span>
<span id="cb245-29"><a href="manipulación-y-agrupación-de-datos.html#cb245-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   conditions &lt;chr&gt;, events &lt;chr&gt;, and abbreviated variable names ¹​dew_point,</span></span>
<span id="cb245-30"><a href="manipulación-y-agrupación-de-datos.html#cb245-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ²​humidity, ³​pressure, ⁴​visibility</span></span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> ¿Qué condiciones climáticas están asociadas
con retrasos en las salidas de Houston?</p>
<p>            Explora
si los aviones más viejos están asociados a mayores retrasos, responde
con una gráfica.</p>
</div>
</div>
<div id="datos-limpios" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Datos limpios<a href="manipulación-y-agrupación-de-datos.html#datos-limpios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Una vez que importamos datos a R es conveniente limpiarlos, esto implica
almacenarlos de una manera consisistente que nos permita
enfocarnos en responder preguntas de los datos en lugar de estar luchando
con los datos. Entonces, <strong>datos limpios</strong> son datos que facilitan las tareas
del análisis de datos:</p>
<ul>
<li><p><strong>Visualización</strong>: Resúmenes de datos usando gráficas, análisis exploratorio,
o presentación de resultados.</p></li>
<li><p><strong>Manipulación</strong>: Manipulación de variables como agregar, filtrar, reordenar,
transformar.</p></li>
<li><p><strong>Modelación</strong>: Ajustar modelos es sencillo si los datos están en la forma
correcta.</p></li>
</ul>
<p>Los principios de <em>datos limpios</em> <span class="citation">(<a href="#ref-tidy" role="doc-biblioref"><strong>tidy?</strong></a>)</span>
proveen una manera estándar de organizar la información:</p>
<ol style="list-style-type: decimal">
<li>Cada variable forma una columna.</li>
<li>Cada observación forma un renglón.</li>
<li>Cada tipo de unidad observacional forma una tabla.</li>
</ol>
<p>Vale la pena notar que los principios de los datos limpios se pueden ver como
teoría de algebra relacional para estadísticos, estós principios equivalen a
la tercera forma normal de Codd con enfoque en una sola tabla de datos en
lugar de muchas conectadas en bases de datos relacionales.</p>
<p>Veamos un ejemplo:</p>
<p>La mayor parte de las bases de datos en estadística tienen forma rectangular,
¿cuántas variables tiene la siguiente tabla?</p>
<div class="mi-tabla">
<table>
<thead>
<tr class="header">
<th></th>
<th>tratamientoA</th>
<th>tratamientoB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Juan Aguirre</td>
<td>-</td>
<td>2</td>
</tr>
<tr class="even">
<td>Ana Bernal</td>
<td>16</td>
<td>11</td>
</tr>
<tr class="odd">
<td>José López</td>
<td>3</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>La tabla anterior también se puede estructurar de la siguiente manera:</p>
<div class="mi-tabla">
<table>
<thead>
<tr class="header">
<th></th>
<th>Juan Aguirre</th>
<th>Ana Bernal</th>
<th>José López</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tratamientoA</td>
<td>-</td>
<td>16</td>
<td>3</td>
</tr>
<tr class="even">
<td>tratamientoB</td>
<td>2</td>
<td>11</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>Si vemos los principios (cada variable forma una columna, cada observación
forma un renglón, cada tipo de unidad observacional forma una tabla), ¿las
tablas anteriores cumplen los principios?</p>
<p>Para responder la pregunta identifiquemos primero cuáles son las variables y
cuáles las observaciones de esta pequeña base. Las variables son:
persona/nombre, tratamiento y resultado. Entonces, siguiendo los principios de
<em>datos limpios</em> obtenemos la siguiente estructura:</p>
<div class="mi-tabla">
<table>
<thead>
<tr class="header">
<th>nombre</th>
<th>tratamiento</th>
<th>resultado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Juan Aguirre</td>
<td>a</td>
<td>-</td>
</tr>
<tr class="even">
<td>Ana Bernal</td>
<td>a</td>
<td>16</td>
</tr>
<tr class="odd">
<td>José López</td>
<td>a</td>
<td>3</td>
</tr>
<tr class="even">
<td>Juan Aguirre</td>
<td>b</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Ana Bernal</td>
<td>b</td>
<td>11</td>
</tr>
<tr class="even">
<td>José López</td>
<td>b</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<div id="limpieza-bases-de-datos" class="section level3 unnumbered hasAnchor">
<h3>Limpieza bases de datos<a href="manipulación-y-agrupación-de-datos.html#limpieza-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Los principios de los datos limpios parecen obvios pero la mayor parte de los
datos no los cumplen debido a:</p>
<ol style="list-style-type: decimal">
<li>La mayor parte de la gente no está familiarizada con los principios y es
difícil derivarlos por uno mismo.<br />
</li>
<li>Los datos suelen estar organizados para facilitar otros aspectos que no son
análisis, por ejemplo, la captura.</li>
</ol>
<p>Algunos de los problemas más comunes en las bases de datos que no están
<em>limpias</em> son:</p>
<ul>
<li>Los encabezados de las columnas son valores y no nombres de variables.</li>
<li>Más de una variable por columna.</li>
<li>Las variables están organizadas tanto en filas como en columnas.</li>
<li>Más de un tipo de observación en una tabla.</li>
<li>Una misma unidad observacional está almacenada en múltiples tablas.</li>
</ul>
<p>La mayor parte de estos problemas se pueden arreglar con pocas herramientas,
a continuación veremos como <em>limpiar</em> datos usando 2 funciones del paquete
<code>tidyr</code>:</p>
<ul>
<li><strong>gather</strong>: recibe múltiples columnas y las junta en pares de valores y
nombres, convierte los datos anchos en largos.<br />
</li>
<li><strong>spread</strong>: recibe 2 columnas y las separa, haciendo los datos más anchos.</li>
</ul>
<p>Repasaremos los problemas más comunes que se encuentran en conjuntos de datos
sucios y mostraremos como se puede manipular la tabla de datos (usando las
funciones <em>gather</em> y <em>spread</em>) con el fin de estructurarla para que cumpla los
principios de datos limpios.</p>
</div>
<div id="los-encabezados-de-las-columanas-son-valores" class="section level3 unnumbered hasAnchor">
<h3>Los encabezados de las columanas son valores<a href="manipulación-y-agrupación-de-datos.html#los-encabezados-de-las-columanas-son-valores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Usaremos ejemplos para entender los conceptos más facilmente.
La primer base de datos está basada en una encuesta de <a href="http://www.pewforum.org/2009/01/30/income-distribution-within-us-religious-groups/">Pew Research</a> que
investiga la relación entre ingreso y afiliación religiosa.</p>
<p>¿Cuáles son las variables en estos datos?</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="manipulación-y-agrupación-de-datos.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb246-2"><a href="manipulación-y-agrupación-de-datos.html#cb246-2" aria-hidden="true" tabindex="-1"></a>pew <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;http://stat405.had.co.nz/data/pew.txt&quot;</span>, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, </span>
<span id="cb246-3"><a href="manipulación-y-agrupación-de-datos.html#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>)</span>
<span id="cb246-4"><a href="manipulación-y-agrupación-de-datos.html#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 18 Columns: 11</span></span>
<span id="cb246-5"><a href="manipulación-y-agrupación-de-datos.html#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb246-6"><a href="manipulación-y-agrupación-de-datos.html#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;\t&quot;</span></span>
<span id="cb246-7"><a href="manipulación-y-agrupación-de-datos.html#cb246-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr  (1): religion</span></span>
<span id="cb246-8"><a href="manipulación-y-agrupación-de-datos.html#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl (10): &lt;$10k, $10-20k, $20-30k, $30-40k, $40-50k, $50-75k, $75-100k, $100...</span></span>
<span id="cb246-9"><a href="manipulación-y-agrupación-de-datos.html#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb246-10"><a href="manipulación-y-agrupación-de-datos.html#cb246-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb246-11"><a href="manipulación-y-agrupación-de-datos.html#cb246-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb246-12"><a href="manipulación-y-agrupación-de-datos.html#cb246-12" aria-hidden="true" tabindex="-1"></a>pew</span>
<span id="cb246-13"><a href="manipulación-y-agrupación-de-datos.html#cb246-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18 × 11</span></span>
<span id="cb246-14"><a href="manipulación-y-agrupación-de-datos.html#cb246-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    religion      `&lt;$10k` $10-2…¹ $20-3…² $30-4…³ $40-5…⁴ $50-7…⁵ $75-1…⁶ $100-…⁷</span></span>
<span id="cb246-15"><a href="manipulación-y-agrupación-de-datos.html#cb246-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb246-16"><a href="manipulación-y-agrupación-de-datos.html#cb246-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Agnostic           27      34      60      81      76     137     122     109</span></span>
<span id="cb246-17"><a href="manipulación-y-agrupación-de-datos.html#cb246-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Atheist            12      27      37      52      35      70      73      59</span></span>
<span id="cb246-18"><a href="manipulación-y-agrupación-de-datos.html#cb246-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Buddhist           27      21      30      34      33      58      62      39</span></span>
<span id="cb246-19"><a href="manipulación-y-agrupación-de-datos.html#cb246-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Catholic          418     617     732     670     638    1116     949     792</span></span>
<span id="cb246-20"><a href="manipulación-y-agrupación-de-datos.html#cb246-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Don’t know/r…      15      14      15      11      10      35      21      17</span></span>
<span id="cb246-21"><a href="manipulación-y-agrupación-de-datos.html#cb246-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Evangelical …     575     869    1064     982     881    1486     949     723</span></span>
<span id="cb246-22"><a href="manipulación-y-agrupación-de-datos.html#cb246-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Hindu               1       9       7       9      11      34      47      48</span></span>
<span id="cb246-23"><a href="manipulación-y-agrupación-de-datos.html#cb246-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Historically…     228     244     236     238     197     223     131      81</span></span>
<span id="cb246-24"><a href="manipulación-y-agrupación-de-datos.html#cb246-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Jehovah&#39;s Wi…      20      27      24      24      21      30      15      11</span></span>
<span id="cb246-25"><a href="manipulación-y-agrupación-de-datos.html#cb246-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Jewish             19      19      25      25      30      95      69      87</span></span>
<span id="cb246-26"><a href="manipulación-y-agrupación-de-datos.html#cb246-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 Mainline Prot     289     495     619     655     651    1107     939     753</span></span>
<span id="cb246-27"><a href="manipulación-y-agrupación-de-datos.html#cb246-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 Mormon             29      40      48      51      56     112      85      49</span></span>
<span id="cb246-28"><a href="manipulación-y-agrupación-de-datos.html#cb246-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Muslim              6       7       9      10       9      23      16       8</span></span>
<span id="cb246-29"><a href="manipulación-y-agrupación-de-datos.html#cb246-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 Orthodox           13      17      23      32      32      47      38      42</span></span>
<span id="cb246-30"><a href="manipulación-y-agrupación-de-datos.html#cb246-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 Other Christ…       9       7      11      13      13      14      18      14</span></span>
<span id="cb246-31"><a href="manipulación-y-agrupación-de-datos.html#cb246-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 Other Faiths       20      33      40      46      49      63      46      40</span></span>
<span id="cb246-32"><a href="manipulación-y-agrupación-de-datos.html#cb246-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17 Other World …       5       2       3       4       2       7       3       4</span></span>
<span id="cb246-33"><a href="manipulación-y-agrupación-de-datos.html#cb246-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18 Unaffiliated      217     299     374     365     341     528     407     321</span></span>
<span id="cb246-34"><a href="manipulación-y-agrupación-de-datos.html#cb246-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2 more variables: `&gt;150k` &lt;dbl&gt;, `Don&#39;t know/refused` &lt;dbl&gt;, and</span></span>
<span id="cb246-35"><a href="manipulación-y-agrupación-de-datos.html#cb246-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   abbreviated variable names ¹​`$10-20k`, ²​`$20-30k`, ³​`$30-40k`, ⁴​`$40-50k`,</span></span>
<span id="cb246-36"><a href="manipulación-y-agrupación-de-datos.html#cb246-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ⁵​`$50-75k`, ⁶​`$75-100k`, ⁷​`$100-150k`</span></span></code></pre></div>
<p>Esta base de datos tiene 3 variables: religión, ingreso y frecuencia. Para
<em>limpiarla</em> es necesario apilar las columnas (alargar los datos). Notemos
que al alargar los datos desapareceran las columnas que se agrupan y dan lugar a
dos nuevas columnas: la correspondiente a clave y la correspondiente a valor.
Entonces, para alargar una base de datos usamos la función <code>gather</code> que recibe
los argumentos:</p>
<ul>
<li>data: base de datos que vamos a reestructurar.<br />
</li>
<li>key: nombre de la nueva variable que contiene lo que fueron los nombres
de columnas que apilamos.<br />
</li>
<li>value: nombre de la variable que almacenará los valores que corresponden a
cada <em>key</em>.<br />
</li>
<li>…: lo último que especificamos son las columnas que vamos a apilar, la notación para seleccionarlas es la misma que usamos con <code>select()</code>.</li>
</ul>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="manipulación-y-agrupación-de-datos.html#cb247-1" aria-hidden="true" tabindex="-1"></a>pew_tidy <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> pew, income, frequency, <span class="sc">-</span>religion)</span>
<span id="cb247-2"><a href="manipulación-y-agrupación-de-datos.html#cb247-2" aria-hidden="true" tabindex="-1"></a>pew_tidy</span>
<span id="cb247-3"><a href="manipulación-y-agrupación-de-datos.html#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 180 × 3</span></span>
<span id="cb247-4"><a href="manipulación-y-agrupación-de-datos.html#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    religion                income frequency</span></span>
<span id="cb247-5"><a href="manipulación-y-agrupación-de-datos.html#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb247-6"><a href="manipulación-y-agrupación-de-datos.html#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Agnostic                &lt;$10k         27</span></span>
<span id="cb247-7"><a href="manipulación-y-agrupación-de-datos.html#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Atheist                 &lt;$10k         12</span></span>
<span id="cb247-8"><a href="manipulación-y-agrupación-de-datos.html#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Buddhist                &lt;$10k         27</span></span>
<span id="cb247-9"><a href="manipulación-y-agrupación-de-datos.html#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Catholic                &lt;$10k        418</span></span>
<span id="cb247-10"><a href="manipulación-y-agrupación-de-datos.html#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Don’t know/refused      &lt;$10k         15</span></span>
<span id="cb247-11"><a href="manipulación-y-agrupación-de-datos.html#cb247-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Evangelical Prot        &lt;$10k        575</span></span>
<span id="cb247-12"><a href="manipulación-y-agrupación-de-datos.html#cb247-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Hindu                   &lt;$10k          1</span></span>
<span id="cb247-13"><a href="manipulación-y-agrupación-de-datos.html#cb247-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Historically Black Prot &lt;$10k        228</span></span>
<span id="cb247-14"><a href="manipulación-y-agrupación-de-datos.html#cb247-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Jehovah&#39;s Witness       &lt;$10k         20</span></span>
<span id="cb247-15"><a href="manipulación-y-agrupación-de-datos.html#cb247-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Jewish                  &lt;$10k         19</span></span>
<span id="cb247-16"><a href="manipulación-y-agrupación-de-datos.html#cb247-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 170 more rows</span></span></code></pre></div>
<p>Observemos que en la tabla ancha teníamos bajo la columna <em>&lt;$10k</em>, en el renglón
correspondiente a <em>Agnostic</em> un valor de 27, y podemos ver que este valor en
la tabla larga se almacena bajo la columna frecuencia y corresponde a religión
<em>Agnostic</em>, income <em>&lt;$10k</em>. También es importante ver que en este ejemplo
especificamos las columnas a apilar identificando la que <strong>no</strong> vamos a alargar
con un signo negativo: es decir apila todas las columnas menos religión.</p>
<p>La nueva estructura de la base de datos nos permite, por ejemplo, hacer
fácilmente una gráfica donde podemos comparar las diferencias en las
frecuencias.</p>
<p>Nota: En esta sección no explicaremos las funciones de graficación pues estas
se cubren en las notas introductorias a R. En esta parte nos queremos concentrar
en como limpiar datos y ejemplificar lo sencillo que es trabajar con datos
limpios, esto es, una vez que los datos fueron reestructurados es fácil
construir gráficas y resúmenes.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="manipulación-y-agrupación-de-datos.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pew_tidy, <span class="fu">aes</span>(<span class="at">x =</span> income, <span class="at">y =</span> frequency, <span class="at">color =</span> religion, <span class="at">group =</span> religion)) <span class="sc">+</span></span>
<span id="cb248-2"><a href="manipulación-y-agrupación-de-datos.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb248-3"><a href="manipulación-y-agrupación-de-datos.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-122-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Podemos hacer gráficas más interesantes si creamos nuevas variables:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="manipulación-y-agrupación-de-datos.html#cb249-1" aria-hidden="true" tabindex="-1"></a>by_religion <span class="ot">&lt;-</span> <span class="fu">group_by</span>(pew_tidy, religion)</span>
<span id="cb249-2"><a href="manipulación-y-agrupación-de-datos.html#cb249-2" aria-hidden="true" tabindex="-1"></a>pew_tidy_2 <span class="ot">&lt;-</span> pew_tidy <span class="sc">%&gt;%</span></span>
<span id="cb249-3"><a href="manipulación-y-agrupación-de-datos.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(income <span class="sc">!=</span> <span class="st">&quot;Don&#39;t know/refused&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-4"><a href="manipulación-y-agrupación-de-datos.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(religion) <span class="sc">%&gt;%</span></span>
<span id="cb249-5"><a href="manipulación-y-agrupación-de-datos.html#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> frequency <span class="sc">/</span> <span class="fu">sum</span>(frequency)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-6"><a href="manipulación-y-agrupación-de-datos.html#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">sum</span>(frequency) <span class="sc">&gt;</span> <span class="dv">1000</span>)</span>
<span id="cb249-7"><a href="manipulación-y-agrupación-de-datos.html#cb249-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pew_tidy_2)</span>
<span id="cb249-8"><a href="manipulación-y-agrupación-de-datos.html#cb249-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb249-9"><a href="manipulación-y-agrupación-de-datos.html#cb249-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   religion [5]</span></span>
<span id="cb249-10"><a href="manipulación-y-agrupación-de-datos.html#cb249-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   religion                income  frequency percent</span></span>
<span id="cb249-11"><a href="manipulación-y-agrupación-de-datos.html#cb249-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb249-12"><a href="manipulación-y-agrupación-de-datos.html#cb249-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Catholic                &lt;$10k         418  0.0637</span></span>
<span id="cb249-13"><a href="manipulación-y-agrupación-de-datos.html#cb249-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Evangelical Prot        &lt;$10k         575  0.0724</span></span>
<span id="cb249-14"><a href="manipulación-y-agrupación-de-datos.html#cb249-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Historically Black Prot &lt;$10k         228  0.138 </span></span>
<span id="cb249-15"><a href="manipulación-y-agrupación-de-datos.html#cb249-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Mainline Prot           &lt;$10k         289  0.0471</span></span>
<span id="cb249-16"><a href="manipulación-y-agrupación-de-datos.html#cb249-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Unaffiliated            &lt;$10k         217  0.0698</span></span>
<span id="cb249-17"><a href="manipulación-y-agrupación-de-datos.html#cb249-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Catholic                $10-20k       617  0.0940</span></span>
<span id="cb249-18"><a href="manipulación-y-agrupación-de-datos.html#cb249-18" aria-hidden="true" tabindex="-1"></a>income_levels <span class="ot">&lt;-</span> <span class="fu">unique</span>(pew_tidy<span class="sc">$</span>income)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb249-19"><a href="manipulación-y-agrupación-de-datos.html#cb249-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pew_tidy_2, <span class="fu">aes</span>(<span class="at">x =</span> income, <span class="at">y =</span> percent, <span class="at">group =</span> religion)) <span class="sc">+</span></span>
<span id="cb249-20"><a href="manipulación-y-agrupación-de-datos.html#cb249-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> religion, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb249-21"><a href="manipulación-y-agrupación-de-datos.html#cb249-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span> </span>
<span id="cb249-22"><a href="manipulación-y-agrupación-de-datos.html#cb249-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb249-23"><a href="manipulación-y-agrupación-de-datos.html#cb249-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> income_levels)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-123-1.png" width="739.2" style="display: block; margin: auto;" /></p>
<p>En el código de arriba utilizamos las funciones <code>group_by</code>, <code>filter</code> y <code>mutate</code>
que estudiaremos más adelante. Por ahora concentremonos en <code>gather</code> y <code>spread</code>.</p>
<p>Otro ejemplo, veamos los datos de <em>Billboard</em>, aquí se registra la fecha en la
que una canción entra por primera vez al top 100 de Billboard.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="manipulación-y-agrupación-de-datos.html#cb250-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/billboard.csv&quot;</span>)</span>
<span id="cb250-2"><a href="manipulación-y-agrupación-de-datos.html#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 317 Columns: 81</span></span>
<span id="cb250-3"><a href="manipulación-y-agrupación-de-datos.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb250-4"><a href="manipulación-y-agrupación-de-datos.html#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb250-5"><a href="manipulación-y-agrupación-de-datos.html#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr   (2): artist, track</span></span>
<span id="cb250-6"><a href="manipulación-y-agrupación-de-datos.html#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl  (66): year, wk1, wk2, wk3, wk4, wk5, wk6, wk7, wk8, wk9, wk10, wk11, wk...</span></span>
<span id="cb250-7"><a href="manipulación-y-agrupación-de-datos.html#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lgl  (11): wk66, wk67, wk68, wk69, wk70, wk71, wk72, wk73, wk74, wk75, wk76</span></span>
<span id="cb250-8"><a href="manipulación-y-agrupación-de-datos.html#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; date  (1): date.entered</span></span>
<span id="cb250-9"><a href="manipulación-y-agrupación-de-datos.html#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; time  (1): time</span></span>
<span id="cb250-10"><a href="manipulación-y-agrupación-de-datos.html#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb250-11"><a href="manipulación-y-agrupación-de-datos.html#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb250-12"><a href="manipulación-y-agrupación-de-datos.html#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb250-13"><a href="manipulación-y-agrupación-de-datos.html#cb250-13" aria-hidden="true" tabindex="-1"></a>billboard</span>
<span id="cb250-14"><a href="manipulación-y-agrupación-de-datos.html#cb250-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 317 × 81</span></span>
<span id="cb250-15"><a href="manipulación-y-agrupación-de-datos.html#cb250-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year artist track time  date.ent…¹   wk1   wk2   wk3   wk4   wk5   wk6   wk7</span></span>
<span id="cb250-16"><a href="manipulación-y-agrupación-de-datos.html#cb250-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;tim&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb250-17"><a href="manipulación-y-agrupación-de-datos.html#cb250-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2000 2 Pac  Baby… 04:22 2000-02-26    87    82    72    77    87    94    99</span></span>
<span id="cb250-18"><a href="manipulación-y-agrupación-de-datos.html#cb250-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2000 2Ge+h… The … 03:15 2000-09-02    91    87    92    NA    NA    NA    NA</span></span>
<span id="cb250-19"><a href="manipulación-y-agrupación-de-datos.html#cb250-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2000 3 Doo… Kryp… 03:53 2000-04-08    81    70    68    67    66    57    54</span></span>
<span id="cb250-20"><a href="manipulación-y-agrupación-de-datos.html#cb250-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2000 3 Doo… Loser 04:24 2000-10-21    76    76    72    69    67    65    55</span></span>
<span id="cb250-21"><a href="manipulación-y-agrupación-de-datos.html#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2000 504 B… Wobb… 03:35 2000-04-15    57    34    25    17    17    31    36</span></span>
<span id="cb250-22"><a href="manipulación-y-agrupación-de-datos.html#cb250-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2000 98^0   Give… 03:24 2000-08-19    51    39    34    26    26    19     2</span></span>
<span id="cb250-23"><a href="manipulación-y-agrupación-de-datos.html#cb250-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2000 A*Tee… Danc… 03:44 2000-07-08    97    97    96    95   100    NA    NA</span></span>
<span id="cb250-24"><a href="manipulación-y-agrupación-de-datos.html#cb250-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2000 Aaliy… I Do… 04:15 2000-01-29    84    62    51    41    38    35    35</span></span>
<span id="cb250-25"><a href="manipulación-y-agrupación-de-datos.html#cb250-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2000 Aaliy… Try … 04:03 2000-03-18    59    53    38    28    21    18    16</span></span>
<span id="cb250-26"><a href="manipulación-y-agrupación-de-datos.html#cb250-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2000 Adams… Open… 05:30 2000-08-26    76    76    74    69    68    67    61</span></span>
<span id="cb250-27"><a href="manipulación-y-agrupación-de-datos.html#cb250-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 307 more rows, 69 more variables: wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,</span></span>
<span id="cb250-28"><a href="manipulación-y-agrupación-de-datos.html#cb250-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,</span></span>
<span id="cb250-29"><a href="manipulación-y-agrupación-de-datos.html#cb250-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;,</span></span>
<span id="cb250-30"><a href="manipulación-y-agrupación-de-datos.html#cb250-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,</span></span>
<span id="cb250-31"><a href="manipulación-y-agrupación-de-datos.html#cb250-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,</span></span>
<span id="cb250-32"><a href="manipulación-y-agrupación-de-datos.html#cb250-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,</span></span>
<span id="cb250-33"><a href="manipulación-y-agrupación-de-datos.html#cb250-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, …</span></span></code></pre></div>
<p>Notemos que el rank en cada semana (una vez que entró a la lista) está guardado
en 75 columnas <code>wk1</code> a <code>wk75</code>, este tipo de almacenamiento no es <em>limpio</em> pero
puede ser útil al momento de ingresar la información.</p>
<p>Para tener datos <em>limpios</em> apilamos las semanas de manera que sea una sola
columna (nuevamente alargamos los datos):</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="manipulación-y-agrupación-de-datos.html#cb251-1" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="ot">&lt;-</span> <span class="fu">gather</span>(billboard, week, rank, wk1<span class="sc">:</span>wk76, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb251-2"><a href="manipulación-y-agrupación-de-datos.html#cb251-2" aria-hidden="true" tabindex="-1"></a>billboard_long</span>
<span id="cb251-3"><a href="manipulación-y-agrupación-de-datos.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,307 × 7</span></span>
<span id="cb251-4"><a href="manipulación-y-agrupación-de-datos.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year artist         track                   time   date.entered week   rank</span></span>
<span id="cb251-5"><a href="manipulación-y-agrupación-de-datos.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                   &lt;time&gt; &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb251-6"><a href="manipulación-y-agrupación-de-datos.html#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2000 2 Pac          Baby Don&#39;t Cry (Keep... 04:22  2000-02-26   wk1      87</span></span>
<span id="cb251-7"><a href="manipulación-y-agrupación-de-datos.html#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2000 2Ge+her        The Hardest Part Of ... 03:15  2000-09-02   wk1      91</span></span>
<span id="cb251-8"><a href="manipulación-y-agrupación-de-datos.html#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2000 3 Doors Down   Kryptonite              03:53  2000-04-08   wk1      81</span></span>
<span id="cb251-9"><a href="manipulación-y-agrupación-de-datos.html#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2000 3 Doors Down   Loser                   04:24  2000-10-21   wk1      76</span></span>
<span id="cb251-10"><a href="manipulación-y-agrupación-de-datos.html#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2000 504 Boyz       Wobble Wobble           03:35  2000-04-15   wk1      57</span></span>
<span id="cb251-11"><a href="manipulación-y-agrupación-de-datos.html#cb251-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2000 98^0           Give Me Just One Nig... 03:24  2000-08-19   wk1      51</span></span>
<span id="cb251-12"><a href="manipulación-y-agrupación-de-datos.html#cb251-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2000 A*Teens        Dancing Queen           03:44  2000-07-08   wk1      97</span></span>
<span id="cb251-13"><a href="manipulación-y-agrupación-de-datos.html#cb251-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2000 Aaliyah        I Don&#39;t Wanna           04:15  2000-01-29   wk1      84</span></span>
<span id="cb251-14"><a href="manipulación-y-agrupación-de-datos.html#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2000 Aaliyah        Try Again               04:03  2000-03-18   wk1      59</span></span>
<span id="cb251-15"><a href="manipulación-y-agrupación-de-datos.html#cb251-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2000 Adams, Yolanda Open My Heart           05:30  2000-08-26   wk1      76</span></span>
<span id="cb251-16"><a href="manipulación-y-agrupación-de-datos.html#cb251-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 5,297 more rows</span></span></code></pre></div>
<p>Notemos que en esta ocasión especificamos las columnas que vamos a apilar
indicando el nombre de la primera de ellas seguido de <code>:</code> y por último el
nombre de la última variable a apilar. Por otra parte, la instrucción
<code>na.rm = TRUE</code> se utiliza para eliminar los renglones con valores faltantes en
la columna de value (rank), esto es, eliminamos aquellas observaciones que
tenían NA en la columnas wk<em>num</em> de la tabla ancha. Ahora realizamos una
limpieza adicional creando mejores variables de fecha.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="manipulación-y-agrupación-de-datos.html#cb252-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy <span class="ot">&lt;-</span> billboard_long <span class="sc">%&gt;%</span></span>
<span id="cb252-2"><a href="manipulación-y-agrupación-de-datos.html#cb252-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb252-3"><a href="manipulación-y-agrupación-de-datos.html#cb252-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">parse_number</span>(week),</span>
<span id="cb252-4"><a href="manipulación-y-agrupación-de-datos.html#cb252-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> date.entered <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> (week <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb252-5"><a href="manipulación-y-agrupación-de-datos.html#cb252-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">as.numeric</span>(rank)</span>
<span id="cb252-6"><a href="manipulación-y-agrupación-de-datos.html#cb252-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb252-7"><a href="manipulación-y-agrupación-de-datos.html#cb252-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>date.entered)</span>
<span id="cb252-8"><a href="manipulación-y-agrupación-de-datos.html#cb252-8" aria-hidden="true" tabindex="-1"></a>billboard_tidy</span>
<span id="cb252-9"><a href="manipulación-y-agrupación-de-datos.html#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,307 × 7</span></span>
<span id="cb252-10"><a href="manipulación-y-agrupación-de-datos.html#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year artist         track                   time    week  rank date      </span></span>
<span id="cb252-11"><a href="manipulación-y-agrupación-de-datos.html#cb252-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                   &lt;time&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span></span>
<span id="cb252-12"><a href="manipulación-y-agrupación-de-datos.html#cb252-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2000 2 Pac          Baby Don&#39;t Cry (Keep... 04:22      1    87 2000-02-26</span></span>
<span id="cb252-13"><a href="manipulación-y-agrupación-de-datos.html#cb252-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2000 2Ge+her        The Hardest Part Of ... 03:15      1    91 2000-09-02</span></span>
<span id="cb252-14"><a href="manipulación-y-agrupación-de-datos.html#cb252-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2000 3 Doors Down   Kryptonite              03:53      1    81 2000-04-08</span></span>
<span id="cb252-15"><a href="manipulación-y-agrupación-de-datos.html#cb252-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2000 3 Doors Down   Loser                   04:24      1    76 2000-10-21</span></span>
<span id="cb252-16"><a href="manipulación-y-agrupación-de-datos.html#cb252-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2000 504 Boyz       Wobble Wobble           03:35      1    57 2000-04-15</span></span>
<span id="cb252-17"><a href="manipulación-y-agrupación-de-datos.html#cb252-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2000 98^0           Give Me Just One Nig... 03:24      1    51 2000-08-19</span></span>
<span id="cb252-18"><a href="manipulación-y-agrupación-de-datos.html#cb252-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2000 A*Teens        Dancing Queen           03:44      1    97 2000-07-08</span></span>
<span id="cb252-19"><a href="manipulación-y-agrupación-de-datos.html#cb252-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2000 Aaliyah        I Don&#39;t Wanna           04:15      1    84 2000-01-29</span></span>
<span id="cb252-20"><a href="manipulación-y-agrupación-de-datos.html#cb252-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2000 Aaliyah        Try Again               04:03      1    59 2000-03-18</span></span>
<span id="cb252-21"><a href="manipulación-y-agrupación-de-datos.html#cb252-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2000 Adams, Yolanda Open My Heart           05:30      1    76 2000-08-26</span></span>
<span id="cb252-22"><a href="manipulación-y-agrupación-de-datos.html#cb252-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 5,297 more rows</span></span></code></pre></div>
<p>Nuevamente, podemos hacer gráficas facilmente.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="manipulación-y-agrupación-de-datos.html#cb253-1" aria-hidden="true" tabindex="-1"></a>tracks <span class="ot">&lt;-</span> <span class="fu">filter</span>(billboard_tidy, track <span class="sc">%in%</span> </span>
<span id="cb253-2"><a href="manipulación-y-agrupación-de-datos.html#cb253-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;Higher&quot;</span>, <span class="st">&quot;Amazed&quot;</span>, <span class="st">&quot;Kryptonite&quot;</span>, <span class="st">&quot;Breathe&quot;</span>, <span class="st">&quot;With Arms Wide Open&quot;</span>))</span>
<span id="cb253-3"><a href="manipulación-y-agrupación-de-datos.html#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tracks, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rank)) <span class="sc">+</span></span>
<span id="cb253-4"><a href="manipulación-y-agrupación-de-datos.html#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb253-5"><a href="manipulación-y-agrupación-de-datos.html#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>track, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb253-6"><a href="manipulación-y-agrupación-de-datos.html#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-127-1.png" width="739.2" style="display: block; margin: auto;" /></p>
</div>
<div id="una-columna-asociada-a-más-de-una-variable" class="section level3 unnumbered hasAnchor">
<h3>Una columna asociada a más de una variable<a href="manipulación-y-agrupación-de-datos.html#una-columna-asociada-a-más-de-una-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La siguiente base de datos proviene de la Organización Mundial de la Salud y
contiene el número de casos confirmados de tuberculosis por país y año, la
información esta por grupo demográfico de acuerdo a sexo (m, f), y edad (0-4,
5-14, etc). Los datos están disponibles en <a href="http://www.who.int/tb/country/data/download/en/" class="uri">http://www.who.int/tb/country/data/download/en/</a>.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="manipulación-y-agrupación-de-datos.html#cb254-1" aria-hidden="true" tabindex="-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/tb.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">tbl_df</span>()</span>
<span id="cb254-2"><a href="manipulación-y-agrupación-de-datos.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `tbl_df()` was deprecated in dplyr 1.0.0.</span></span>
<span id="cb254-3"><a href="manipulación-y-agrupación-de-datos.html#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `tibble::as_tibble()` instead.</span></span>
<span id="cb254-4"><a href="manipulación-y-agrupación-de-datos.html#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span id="cb254-5"><a href="manipulación-y-agrupación-de-datos.html#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb254-6"><a href="manipulación-y-agrupación-de-datos.html#cb254-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb254-7"><a href="manipulación-y-agrupación-de-datos.html#cb254-7" aria-hidden="true" tabindex="-1"></a>tb</span>
<span id="cb254-8"><a href="manipulación-y-agrupación-de-datos.html#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,769 × 22</span></span>
<span id="cb254-9"><a href="manipulación-y-agrupación-de-datos.html#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    iso2   year new_sp_…¹ new_s…² new_s…³ new_s…⁴ new_s…⁵ new_s…⁶ new_s…⁷ new_s…⁸</span></span>
<span id="cb254-10"><a href="manipulación-y-agrupación-de-datos.html#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt; &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;</span></span>
<span id="cb254-11"><a href="manipulación-y-agrupación-de-datos.html#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 AD     1989        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-12"><a href="manipulación-y-agrupación-de-datos.html#cb254-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 AD     1990        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-13"><a href="manipulación-y-agrupación-de-datos.html#cb254-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AD     1991        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-14"><a href="manipulación-y-agrupación-de-datos.html#cb254-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 AD     1992        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-15"><a href="manipulación-y-agrupación-de-datos.html#cb254-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 AD     1993        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-16"><a href="manipulación-y-agrupación-de-datos.html#cb254-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 AD     1994        NA      NA      NA      NA      NA      NA      NA      NA</span></span>
<span id="cb254-17"><a href="manipulación-y-agrupación-de-datos.html#cb254-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 AD     1996        NA      NA       0       0       0       4       1       0</span></span>
<span id="cb254-18"><a href="manipulación-y-agrupación-de-datos.html#cb254-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 AD     1997        NA      NA       0       0       1       2       2       1</span></span>
<span id="cb254-19"><a href="manipulación-y-agrupación-de-datos.html#cb254-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 AD     1998        NA      NA       0       0       0       1       0       0</span></span>
<span id="cb254-20"><a href="manipulación-y-agrupación-de-datos.html#cb254-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 AD     1999        NA      NA       0       0       0       1       1       0</span></span>
<span id="cb254-21"><a href="manipulación-y-agrupación-de-datos.html#cb254-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 5,759 more rows, 12 more variables: new_sp_m65 &lt;int&gt;, new_sp_mu &lt;int&gt;,</span></span>
<span id="cb254-22"><a href="manipulación-y-agrupación-de-datos.html#cb254-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   new_sp_f04 &lt;int&gt;, new_sp_f514 &lt;int&gt;, new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;,</span></span>
<span id="cb254-23"><a href="manipulación-y-agrupación-de-datos.html#cb254-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;,</span></span>
<span id="cb254-24"><a href="manipulación-y-agrupación-de-datos.html#cb254-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   new_sp_f5564 &lt;int&gt;, new_sp_f65 &lt;int&gt;, new_sp_fu &lt;int&gt;, and abbreviated</span></span>
<span id="cb254-25"><a href="manipulación-y-agrupación-de-datos.html#cb254-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   variable names ¹​new_sp_m04, ²​new_sp_m514, ³​new_sp_m014, ⁴​new_sp_m1524,</span></span>
<span id="cb254-26"><a href="manipulación-y-agrupación-de-datos.html#cb254-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ⁵​new_sp_m2534, ⁶​new_sp_m3544, ⁷​new_sp_m4554, ⁸​new_sp_m5564</span></span></code></pre></div>
<p><img src="imagenes/manicule2.jpg" /> De manera similar a los ejemplos anteriores,
utiliza la función <code>gather</code> para apilar las columnas correspondientes a
sexo-edad.</p>
<p>            Piensa en
como podemos separar la “variable” sexo-edad en dos columnas.</p>
<p>Ahora separaremos las variables sexo y edad de la columna demo, para ello
debemos pasar a la función <code>separate()</code>, esta recibe como parámetros:</p>
<ul>
<li><p>el nombre de la base de datos,</p></li>
<li><p>el nombre de la variable que deseamos separar en más de una,</p></li>
<li><p>la posición de donde deseamos “cortar” (hay más opciones para especificar
como separar, ver <code>?separate</code>). El default es separar valores en todos los
lugares que encuentre un caracter que no es alfanumérico (espacio, guión,…).</p></li>
</ul>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="manipulación-y-agrupación-de-datos.html#cb255-1" aria-hidden="true" tabindex="-1"></a>tb_tidy <span class="ot">&lt;-</span> <span class="fu">separate</span>(tb_long, demo, <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dv">8</span>)</span>
<span id="cb255-2"><a href="manipulación-y-agrupación-de-datos.html#cb255-2" aria-hidden="true" tabindex="-1"></a>tb_tidy</span>
<span id="cb255-3"><a href="manipulación-y-agrupación-de-datos.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 35,750 × 5</span></span>
<span id="cb255-4"><a href="manipulación-y-agrupación-de-datos.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    iso2   year sex      age       n</span></span>
<span id="cb255-5"><a href="manipulación-y-agrupación-de-datos.html#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb255-6"><a href="manipulación-y-agrupación-de-datos.html#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 AD     2005 new_sp_m 04        0</span></span>
<span id="cb255-7"><a href="manipulación-y-agrupación-de-datos.html#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 AD     2006 new_sp_m 04        0</span></span>
<span id="cb255-8"><a href="manipulación-y-agrupación-de-datos.html#cb255-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AD     2008 new_sp_m 04        0</span></span>
<span id="cb255-9"><a href="manipulación-y-agrupación-de-datos.html#cb255-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 AE     2006 new_sp_m 04        0</span></span>
<span id="cb255-10"><a href="manipulación-y-agrupación-de-datos.html#cb255-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 AE     2007 new_sp_m 04        0</span></span>
<span id="cb255-11"><a href="manipulación-y-agrupación-de-datos.html#cb255-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 AE     2008 new_sp_m 04        0</span></span>
<span id="cb255-12"><a href="manipulación-y-agrupación-de-datos.html#cb255-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 AG     2007 new_sp_m 04        0</span></span>
<span id="cb255-13"><a href="manipulación-y-agrupación-de-datos.html#cb255-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 AL     2005 new_sp_m 04        0</span></span>
<span id="cb255-14"><a href="manipulación-y-agrupación-de-datos.html#cb255-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 AL     2006 new_sp_m 04        1</span></span>
<span id="cb255-15"><a href="manipulación-y-agrupación-de-datos.html#cb255-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 AL     2007 new_sp_m 04        0</span></span>
<span id="cb255-16"><a href="manipulación-y-agrupación-de-datos.html#cb255-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 35,740 more rows</span></span>
<span id="cb255-17"><a href="manipulación-y-agrupación-de-datos.html#cb255-17" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tb_tidy<span class="sc">$</span>sex)</span>
<span id="cb255-18"><a href="manipulación-y-agrupación-de-datos.html#cb255-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb255-19"><a href="manipulación-y-agrupación-de-datos.html#cb255-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; new_sp_f new_sp_m </span></span>
<span id="cb255-20"><a href="manipulación-y-agrupación-de-datos.html#cb255-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    17830    17920</span></span>
<span id="cb255-21"><a href="manipulación-y-agrupación-de-datos.html#cb255-21" aria-hidden="true" tabindex="-1"></a><span class="co"># creamos un mejor código de genero</span></span>
<span id="cb255-22"><a href="manipulación-y-agrupación-de-datos.html#cb255-22" aria-hidden="true" tabindex="-1"></a>tb_tidy <span class="ot">&lt;-</span> <span class="fu">mutate</span>(tb_tidy, <span class="at">sex =</span> <span class="fu">substr</span>(sex, <span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb255-23"><a href="manipulación-y-agrupación-de-datos.html#cb255-23" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tb_tidy<span class="sc">$</span>sex)</span>
<span id="cb255-24"><a href="manipulación-y-agrupación-de-datos.html#cb255-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb255-25"><a href="manipulación-y-agrupación-de-datos.html#cb255-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     f     m </span></span>
<span id="cb255-26"><a href="manipulación-y-agrupación-de-datos.html#cb255-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17830 17920</span></span></code></pre></div>
</div>
<div id="variables-almacenadas-en-filas-y-columnas" class="section level3 unnumbered hasAnchor">
<h3>Variables almacenadas en filas y columnas<a href="manipulación-y-agrupación-de-datos.html#variables-almacenadas-en-filas-y-columnas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El problema más difícil es cuando las variables están tanto en filas como en
columnas, veamos una base de datos de clima en Cuernavaca. ¿Cuáles son las
variables en estos datos?</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="manipulación-y-agrupación-de-datos.html#cb256-1" aria-hidden="true" tabindex="-1"></a>clima <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/clima.txt&quot;</span>, <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, </span>
<span id="cb256-2"><a href="manipulación-y-agrupación-de-datos.html#cb256-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">trim_ws =</span> <span class="cn">TRUE</span>)</span>
<span id="cb256-3"><a href="manipulación-y-agrupación-de-datos.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 22 Columns: 35</span></span>
<span id="cb256-4"><a href="manipulación-y-agrupación-de-datos.html#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb256-5"><a href="manipulación-y-agrupación-de-datos.html#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;\t&quot;</span></span>
<span id="cb256-6"><a href="manipulación-y-agrupación-de-datos.html#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr  (2): id, element</span></span>
<span id="cb256-7"><a href="manipulación-y-agrupación-de-datos.html#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl (25): year, month, d1, d2, d3, d4, d5, d6, d7, d8, d10, d11, d13, d14, d...</span></span>
<span id="cb256-8"><a href="manipulación-y-agrupación-de-datos.html#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lgl  (8): d9, d12, d18, d19, d20, d21, d22, d24</span></span>
<span id="cb256-9"><a href="manipulación-y-agrupación-de-datos.html#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb256-10"><a href="manipulación-y-agrupación-de-datos.html#cb256-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb256-11"><a href="manipulación-y-agrupación-de-datos.html#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre></div>
<p>Estos datos tienen variables en columnas individuales (id, año, mes), en
múltiples columnas (día, d1-d31) y en filas (tmin, tmax). Comencemos por apilar
las columnas.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="manipulación-y-agrupación-de-datos.html#cb257-1" aria-hidden="true" tabindex="-1"></a>clima_long <span class="ot">&lt;-</span> <span class="fu">gather</span>(clima, day, value, d1<span class="sc">:</span>d31, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb257-2"><a href="manipulación-y-agrupación-de-datos.html#cb257-2" aria-hidden="true" tabindex="-1"></a>clima_long</span>
<span id="cb257-3"><a href="manipulación-y-agrupación-de-datos.html#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 66 × 6</span></span>
<span id="cb257-4"><a href="manipulación-y-agrupación-de-datos.html#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id           year month element day   value</span></span>
<span id="cb257-5"><a href="manipulación-y-agrupación-de-datos.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb257-6"><a href="manipulación-y-agrupación-de-datos.html#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 MX000017004  2010    12 TMAX    d1      299</span></span>
<span id="cb257-7"><a href="manipulación-y-agrupación-de-datos.html#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 MX000017004  2010    12 TMIN    d1      138</span></span>
<span id="cb257-8"><a href="manipulación-y-agrupación-de-datos.html#cb257-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 MX000017004  2010     2 TMAX    d2      273</span></span>
<span id="cb257-9"><a href="manipulación-y-agrupación-de-datos.html#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 MX000017004  2010     2 TMIN    d2      144</span></span>
<span id="cb257-10"><a href="manipulación-y-agrupación-de-datos.html#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 MX000017004  2010    11 TMAX    d2      313</span></span>
<span id="cb257-11"><a href="manipulación-y-agrupación-de-datos.html#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 MX000017004  2010    11 TMIN    d2      163</span></span>
<span id="cb257-12"><a href="manipulación-y-agrupación-de-datos.html#cb257-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 MX000017004  2010     2 TMAX    d3      241</span></span>
<span id="cb257-13"><a href="manipulación-y-agrupación-de-datos.html#cb257-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 MX000017004  2010     2 TMIN    d3      144</span></span>
<span id="cb257-14"><a href="manipulación-y-agrupación-de-datos.html#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 MX000017004  2010     7 TMAX    d3      286</span></span>
<span id="cb257-15"><a href="manipulación-y-agrupación-de-datos.html#cb257-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 MX000017004  2010     7 TMIN    d3      175</span></span>
<span id="cb257-16"><a href="manipulación-y-agrupación-de-datos.html#cb257-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 56 more rows</span></span></code></pre></div>
<p>Podemos crear algunas variables adicionales.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="manipulación-y-agrupación-de-datos.html#cb258-1" aria-hidden="true" tabindex="-1"></a>clima_vars <span class="ot">&lt;-</span> clima_long <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="manipulación-y-agrupación-de-datos.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day =</span> <span class="fu">parse_number</span>(day), </span>
<span id="cb258-3"><a href="manipulación-y-agrupación-de-datos.html#cb258-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value) <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb258-4"><a href="manipulación-y-agrupación-de-datos.html#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, year, month, day, element, value) <span class="sc">%&gt;%</span></span>
<span id="cb258-5"><a href="manipulación-y-agrupación-de-datos.html#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, year, month, day)</span>
<span id="cb258-6"><a href="manipulación-y-agrupación-de-datos.html#cb258-6" aria-hidden="true" tabindex="-1"></a>clima_vars</span>
<span id="cb258-7"><a href="manipulación-y-agrupación-de-datos.html#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 66 × 6</span></span>
<span id="cb258-8"><a href="manipulación-y-agrupación-de-datos.html#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id           year month   day element value</span></span>
<span id="cb258-9"><a href="manipulación-y-agrupación-de-datos.html#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span id="cb258-10"><a href="manipulación-y-agrupación-de-datos.html#cb258-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 MX000017004  2010     1    30 TMAX     27.8</span></span>
<span id="cb258-11"><a href="manipulación-y-agrupación-de-datos.html#cb258-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 MX000017004  2010     1    30 TMIN     14.5</span></span>
<span id="cb258-12"><a href="manipulación-y-agrupación-de-datos.html#cb258-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 MX000017004  2010     2     2 TMAX     27.3</span></span>
<span id="cb258-13"><a href="manipulación-y-agrupación-de-datos.html#cb258-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 MX000017004  2010     2     2 TMIN     14.4</span></span>
<span id="cb258-14"><a href="manipulación-y-agrupación-de-datos.html#cb258-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 MX000017004  2010     2     3 TMAX     24.1</span></span>
<span id="cb258-15"><a href="manipulación-y-agrupación-de-datos.html#cb258-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 MX000017004  2010     2     3 TMIN     14.4</span></span>
<span id="cb258-16"><a href="manipulación-y-agrupación-de-datos.html#cb258-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 MX000017004  2010     2    11 TMAX     29.7</span></span>
<span id="cb258-17"><a href="manipulación-y-agrupación-de-datos.html#cb258-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 MX000017004  2010     2    11 TMIN     13.4</span></span>
<span id="cb258-18"><a href="manipulación-y-agrupación-de-datos.html#cb258-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 MX000017004  2010     2    23 TMAX     29.9</span></span>
<span id="cb258-19"><a href="manipulación-y-agrupación-de-datos.html#cb258-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 MX000017004  2010     2    23 TMIN     10.7</span></span>
<span id="cb258-20"><a href="manipulación-y-agrupación-de-datos.html#cb258-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 56 more rows</span></span></code></pre></div>
<p>Finalmente, la columna <em>element</em> no es una variable, sino que almacena el nombre
de dos variables, la operación que debemos aplicar (spread) es el inverso de
apilar (<code>gather</code>):</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="manipulación-y-agrupación-de-datos.html#cb259-1" aria-hidden="true" tabindex="-1"></a>clima_tidy <span class="ot">&lt;-</span> <span class="fu">spread</span>(clima_vars, element, value)</span>
<span id="cb259-2"><a href="manipulación-y-agrupación-de-datos.html#cb259-2" aria-hidden="true" tabindex="-1"></a>clima_tidy</span>
<span id="cb259-3"><a href="manipulación-y-agrupación-de-datos.html#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 33 × 6</span></span>
<span id="cb259-4"><a href="manipulación-y-agrupación-de-datos.html#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id           year month   day  TMAX  TMIN</span></span>
<span id="cb259-5"><a href="manipulación-y-agrupación-de-datos.html#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb259-6"><a href="manipulación-y-agrupación-de-datos.html#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 MX000017004  2010     1    30  27.8  14.5</span></span>
<span id="cb259-7"><a href="manipulación-y-agrupación-de-datos.html#cb259-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 MX000017004  2010     2     2  27.3  14.4</span></span>
<span id="cb259-8"><a href="manipulación-y-agrupación-de-datos.html#cb259-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 MX000017004  2010     2     3  24.1  14.4</span></span>
<span id="cb259-9"><a href="manipulación-y-agrupación-de-datos.html#cb259-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 MX000017004  2010     2    11  29.7  13.4</span></span>
<span id="cb259-10"><a href="manipulación-y-agrupación-de-datos.html#cb259-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 MX000017004  2010     2    23  29.9  10.7</span></span>
<span id="cb259-11"><a href="manipulación-y-agrupación-de-datos.html#cb259-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 MX000017004  2010     3     5  32.1  14.2</span></span>
<span id="cb259-12"><a href="manipulación-y-agrupación-de-datos.html#cb259-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 MX000017004  2010     3    10  34.5  16.8</span></span>
<span id="cb259-13"><a href="manipulación-y-agrupación-de-datos.html#cb259-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 MX000017004  2010     3    16  31.1  17.6</span></span>
<span id="cb259-14"><a href="manipulación-y-agrupación-de-datos.html#cb259-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 MX000017004  2010     4    27  36.3  16.7</span></span>
<span id="cb259-15"><a href="manipulación-y-agrupación-de-datos.html#cb259-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 MX000017004  2010     5    27  33.2  18.2</span></span>
<span id="cb259-16"><a href="manipulación-y-agrupación-de-datos.html#cb259-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 23 more rows</span></span></code></pre></div>
<p>Ahora es inmediato no solo hacer gráficas sino también ajustar un modelo.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="manipulación-y-agrupación-de-datos.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ajustamos un modelo lineal donde la variable respuesta es temperatura </span></span>
<span id="cb260-2"><a href="manipulación-y-agrupación-de-datos.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># máxima, y la variable explicativa es el mes</span></span>
<span id="cb260-3"><a href="manipulación-y-agrupación-de-datos.html#cb260-3" aria-hidden="true" tabindex="-1"></a>clima_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(TMAX <span class="sc">~</span> <span class="fu">factor</span>(month), <span class="at">data =</span> clima_tidy)</span>
<span id="cb260-4"><a href="manipulación-y-agrupación-de-datos.html#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(clima_lm)</span>
<span id="cb260-5"><a href="manipulación-y-agrupación-de-datos.html#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb260-6"><a href="manipulación-y-agrupación-de-datos.html#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb260-7"><a href="manipulación-y-agrupación-de-datos.html#cb260-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = TMAX ~ factor(month), data = clima_tidy)</span></span>
<span id="cb260-8"><a href="manipulación-y-agrupación-de-datos.html#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb260-9"><a href="manipulación-y-agrupación-de-datos.html#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb260-10"><a href="manipulación-y-agrupación-de-datos.html#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb260-11"><a href="manipulación-y-agrupación-de-datos.html#cb260-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  -3.65  -0.92  -0.02   1.05   3.18 </span></span>
<span id="cb260-12"><a href="manipulación-y-agrupación-de-datos.html#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb260-13"><a href="manipulación-y-agrupación-de-datos.html#cb260-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb260-14"><a href="manipulación-y-agrupación-de-datos.html#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb260-15"><a href="manipulación-y-agrupación-de-datos.html#cb260-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)      27.8000     1.8610  14.938 5.34e-13 ***</span></span>
<span id="cb260-16"><a href="manipulación-y-agrupación-de-datos.html#cb260-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)2   -0.0500     2.0807  -0.024  0.98104    </span></span>
<span id="cb260-17"><a href="manipulación-y-agrupación-de-datos.html#cb260-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)3    4.7667     2.1489   2.218  0.03717 *  </span></span>
<span id="cb260-18"><a href="manipulación-y-agrupación-de-datos.html#cb260-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)4    8.5000     2.6319   3.230  0.00385 ** </span></span>
<span id="cb260-19"><a href="manipulación-y-agrupación-de-datos.html#cb260-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)5    5.4000     2.6319   2.052  0.05228 .  </span></span>
<span id="cb260-20"><a href="manipulación-y-agrupación-de-datos.html#cb260-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)6    1.2500     2.2793   0.548  0.58892    </span></span>
<span id="cb260-21"><a href="manipulación-y-agrupación-de-datos.html#cb260-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)7    1.4500     2.2793   0.636  0.53123    </span></span>
<span id="cb260-22"><a href="manipulación-y-agrupación-de-datos.html#cb260-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)8    0.4714     1.9895   0.237  0.81488    </span></span>
<span id="cb260-23"><a href="manipulación-y-agrupación-de-datos.html#cb260-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)10   1.1000     2.0386   0.540  0.59491    </span></span>
<span id="cb260-24"><a href="manipulación-y-agrupación-de-datos.html#cb260-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)11   0.3200     2.0386   0.157  0.87670    </span></span>
<span id="cb260-25"><a href="manipulación-y-agrupación-de-datos.html#cb260-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; factor(month)12   1.0500     2.2793   0.461  0.64955    </span></span>
<span id="cb260-26"><a href="manipulación-y-agrupación-de-datos.html#cb260-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb260-27"><a href="manipulación-y-agrupación-de-datos.html#cb260-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb260-28"><a href="manipulación-y-agrupación-de-datos.html#cb260-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb260-29"><a href="manipulación-y-agrupación-de-datos.html#cb260-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 1.861 on 22 degrees of freedom</span></span>
<span id="cb260-30"><a href="manipulación-y-agrupación-de-datos.html#cb260-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.6182, Adjusted R-squared:  0.4447 </span></span>
<span id="cb260-31"><a href="manipulación-y-agrupación-de-datos.html#cb260-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic: 3.563 on 10 and 22 DF,  p-value: 0.006196</span></span></code></pre></div>
</div>
<div id="mas-de-un-tipo-de-observación-en-una-misma-tabla" class="section level3 unnumbered hasAnchor">
<h3>Mas de un tipo de observación en una misma tabla<a href="manipulación-y-agrupación-de-datos.html#mas-de-un-tipo-de-observación-en-una-misma-tabla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En ocasiones las bases de datos involucran valores en diferentes niveles, en
diferentes tipos de unidad observacional. En la limpieza de datos, cada unidad
observacional debe estar almacenada en su propia tabla (esto esta ligado a
normalización de una base de datos), es importante para evitar inconsistencias
en los datos.</p>
<p>¿Cuáles son las unidades observacionales de los datos de billboard?</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="manipulación-y-agrupación-de-datos.html#cb261-1" aria-hidden="true" tabindex="-1"></a>billboard_tidy</span>
<span id="cb261-2"><a href="manipulación-y-agrupación-de-datos.html#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,307 × 7</span></span>
<span id="cb261-3"><a href="manipulación-y-agrupación-de-datos.html#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year artist         track                   time    week  rank date      </span></span>
<span id="cb261-4"><a href="manipulación-y-agrupación-de-datos.html#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                   &lt;time&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span></span>
<span id="cb261-5"><a href="manipulación-y-agrupación-de-datos.html#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2000 2 Pac          Baby Don&#39;t Cry (Keep... 04:22      1    87 2000-02-26</span></span>
<span id="cb261-6"><a href="manipulación-y-agrupación-de-datos.html#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2000 2Ge+her        The Hardest Part Of ... 03:15      1    91 2000-09-02</span></span>
<span id="cb261-7"><a href="manipulación-y-agrupación-de-datos.html#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2000 3 Doors Down   Kryptonite              03:53      1    81 2000-04-08</span></span>
<span id="cb261-8"><a href="manipulación-y-agrupación-de-datos.html#cb261-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2000 3 Doors Down   Loser                   04:24      1    76 2000-10-21</span></span>
<span id="cb261-9"><a href="manipulación-y-agrupación-de-datos.html#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2000 504 Boyz       Wobble Wobble           03:35      1    57 2000-04-15</span></span>
<span id="cb261-10"><a href="manipulación-y-agrupación-de-datos.html#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2000 98^0           Give Me Just One Nig... 03:24      1    51 2000-08-19</span></span>
<span id="cb261-11"><a href="manipulación-y-agrupación-de-datos.html#cb261-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2000 A*Teens        Dancing Queen           03:44      1    97 2000-07-08</span></span>
<span id="cb261-12"><a href="manipulación-y-agrupación-de-datos.html#cb261-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2000 Aaliyah        I Don&#39;t Wanna           04:15      1    84 2000-01-29</span></span>
<span id="cb261-13"><a href="manipulación-y-agrupación-de-datos.html#cb261-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2000 Aaliyah        Try Again               04:03      1    59 2000-03-18</span></span>
<span id="cb261-14"><a href="manipulación-y-agrupación-de-datos.html#cb261-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2000 Adams, Yolanda Open My Heart           05:30      1    76 2000-08-26</span></span>
<span id="cb261-15"><a href="manipulación-y-agrupación-de-datos.html#cb261-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 5,297 more rows</span></span></code></pre></div>
<p>Separemos esta base de datos en dos: la tabla canción que almacena artista,
nombre de la canción y duración; la tabla rank que almacena el ranking de la
canción en cada semana.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="manipulación-y-agrupación-de-datos.html#cb262-1" aria-hidden="true" tabindex="-1"></a>song <span class="ot">&lt;-</span> billboard_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb262-2"><a href="manipulación-y-agrupación-de-datos.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(artist, track, year, time) <span class="sc">%&gt;%</span></span>
<span id="cb262-3"><a href="manipulación-y-agrupación-de-datos.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb262-4"><a href="manipulación-y-agrupación-de-datos.html#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(artist) <span class="sc">%&gt;%</span></span>
<span id="cb262-5"><a href="manipulación-y-agrupación-de-datos.html#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">song_id =</span> <span class="fu">row_number</span>(artist))</span>
<span id="cb262-6"><a href="manipulación-y-agrupación-de-datos.html#cb262-6" aria-hidden="true" tabindex="-1"></a>song</span>
<span id="cb262-7"><a href="manipulación-y-agrupación-de-datos.html#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 317 × 5</span></span>
<span id="cb262-8"><a href="manipulación-y-agrupación-de-datos.html#cb262-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    artist         track                    year time   song_id</span></span>
<span id="cb262-9"><a href="manipulación-y-agrupación-de-datos.html#cb262-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;                   &lt;dbl&gt; &lt;time&gt;   &lt;int&gt;</span></span>
<span id="cb262-10"><a href="manipulación-y-agrupación-de-datos.html#cb262-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2 Pac          Baby Don&#39;t Cry (Keep...  2000 04:22        1</span></span>
<span id="cb262-11"><a href="manipulación-y-agrupación-de-datos.html#cb262-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2Ge+her        The Hardest Part Of ...  2000 03:15        2</span></span>
<span id="cb262-12"><a href="manipulación-y-agrupación-de-datos.html#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 3 Doors Down   Kryptonite               2000 03:53        3</span></span>
<span id="cb262-13"><a href="manipulación-y-agrupación-de-datos.html#cb262-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 3 Doors Down   Loser                    2000 04:24        4</span></span>
<span id="cb262-14"><a href="manipulación-y-agrupación-de-datos.html#cb262-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 504 Boyz       Wobble Wobble            2000 03:35        5</span></span>
<span id="cb262-15"><a href="manipulación-y-agrupación-de-datos.html#cb262-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 98^0           Give Me Just One Nig...  2000 03:24        6</span></span>
<span id="cb262-16"><a href="manipulación-y-agrupación-de-datos.html#cb262-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 A*Teens        Dancing Queen            2000 03:44        7</span></span>
<span id="cb262-17"><a href="manipulación-y-agrupación-de-datos.html#cb262-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Aaliyah        I Don&#39;t Wanna            2000 04:15        8</span></span>
<span id="cb262-18"><a href="manipulación-y-agrupación-de-datos.html#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Aaliyah        Try Again                2000 04:03        9</span></span>
<span id="cb262-19"><a href="manipulación-y-agrupación-de-datos.html#cb262-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Adams, Yolanda Open My Heart            2000 05:30       10</span></span>
<span id="cb262-20"><a href="manipulación-y-agrupación-de-datos.html#cb262-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 307 more rows</span></span>
<span id="cb262-21"><a href="manipulación-y-agrupación-de-datos.html#cb262-21" aria-hidden="true" tabindex="-1"></a>rank <span class="ot">&lt;-</span> billboard_tidy <span class="sc">%&gt;%</span></span>
<span id="cb262-22"><a href="manipulación-y-agrupación-de-datos.html#cb262-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(song, <span class="fu">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb262-23"><a href="manipulación-y-agrupación-de-datos.html#cb262-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(song_id, date, week, rank) <span class="sc">%&gt;%</span></span>
<span id="cb262-24"><a href="manipulación-y-agrupación-de-datos.html#cb262-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(song_id, date) <span class="sc">%&gt;%</span></span>
<span id="cb262-25"><a href="manipulación-y-agrupación-de-datos.html#cb262-25" aria-hidden="true" tabindex="-1"></a>  tbl_df</span>
<span id="cb262-26"><a href="manipulación-y-agrupación-de-datos.html#cb262-26" aria-hidden="true" tabindex="-1"></a>rank</span>
<span id="cb262-27"><a href="manipulación-y-agrupación-de-datos.html#cb262-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5,307 × 4</span></span>
<span id="cb262-28"><a href="manipulación-y-agrupación-de-datos.html#cb262-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    song_id date        week  rank</span></span>
<span id="cb262-29"><a href="manipulación-y-agrupación-de-datos.html#cb262-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb262-30"><a href="manipulación-y-agrupación-de-datos.html#cb262-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1 2000-02-26     1    87</span></span>
<span id="cb262-31"><a href="manipulación-y-agrupación-de-datos.html#cb262-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1 2000-03-04     2    82</span></span>
<span id="cb262-32"><a href="manipulación-y-agrupación-de-datos.html#cb262-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1 2000-03-11     3    72</span></span>
<span id="cb262-33"><a href="manipulación-y-agrupación-de-datos.html#cb262-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1 2000-03-18     4    77</span></span>
<span id="cb262-34"><a href="manipulación-y-agrupación-de-datos.html#cb262-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       1 2000-03-25     5    87</span></span>
<span id="cb262-35"><a href="manipulación-y-agrupación-de-datos.html#cb262-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       1 2000-04-01     6    94</span></span>
<span id="cb262-36"><a href="manipulación-y-agrupación-de-datos.html#cb262-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       1 2000-04-08     7    99</span></span>
<span id="cb262-37"><a href="manipulación-y-agrupación-de-datos.html#cb262-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       2 2000-09-02     1    91</span></span>
<span id="cb262-38"><a href="manipulación-y-agrupación-de-datos.html#cb262-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       2 2000-09-09     2    87</span></span>
<span id="cb262-39"><a href="manipulación-y-agrupación-de-datos.html#cb262-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       2 2000-09-16     3    92</span></span>
<span id="cb262-40"><a href="manipulación-y-agrupación-de-datos.html#cb262-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 5,297 more rows</span></span></code></pre></div>
</div>
<div id="una-misma-unidad-observacional-está-almacenada-en-múltiples-tablas" class="section level3 unnumbered hasAnchor">
<h3>Una misma unidad observacional está almacenada en múltiples tablas<a href="manipulación-y-agrupación-de-datos.html#una-misma-unidad-observacional-está-almacenada-en-múltiples-tablas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>También es común que los valores sobre una misma unidad observacional estén
separados en muchas tablas o archivos, es común que estas tablas esten divididas
de acuerdo a una variable, de tal manera que cada archivo representa a una
persona, año o ubicación. Para juntar los archivos hacemos lo siguiente:</p>
<ol style="list-style-type: decimal">
<li>Leemos los archivos en una lista de tablas.</li>
<li>Para cada tabla agregamos una columna que registra el nombre del archivo
original.</li>
<li>Combinamos las tablas en un solo data frame.</li>
</ol>
<p>Veamos un ejemplo, descarga la carpeta
<a href="https://www.dropbox.com/sh/c0mgho95gwjc1mv/AACVLPr33O6ENW68xmL7hyUna?dl=0">specdata</a>,
ésta contiene 332 archivos csv que almacenan información de monitoreo de
contaminación en 332 ubicaciones de EUA. Cada archivo contiene información de
una unidad de monitoreo y el número de identificación del monitor es el nombre
del archivo.</p>
<p>Los pasos en R (usando el paquete <code>purrr</code>), primero creamos un vector con los
nombres de los archivos en un directorio, eligiendo aquellos que contengan las
letras “.csv”.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="manipulación-y-agrupación-de-datos.html#cb263-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="st">&quot;data/specdata&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.csv$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<p>Después le asignamos el nombre del csv al nombre de cada elemento del vector.
Este paso se realiza para preservar los nombres de los archivos ya que estos
los asignaremos a una variable mas adelante.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="manipulación-y-agrupación-de-datos.html#cb264-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">set_names</span>(paths, <span class="fu">basename</span>(paths))</span></code></pre></div>
<p>La función <code>map_df</code> itera sobre cada dirección, lee el csv en dicha dirección y
los combina en un data frame.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="manipulación-y-agrupación-de-datos.html#cb265-1" aria-hidden="true" tabindex="-1"></a>specdata_us <span class="ot">&lt;-</span> <span class="fu">map_df</span>(paths, <span class="sc">~</span><span class="fu">read_csv</span>(., <span class="at">col_types =</span> <span class="st">&quot;Tddi&quot;</span>), <span class="at">.id =</span> <span class="st">&quot;filename&quot;</span>)</span>
<span id="cb265-2"><a href="manipulación-y-agrupación-de-datos.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="co"># eliminamos la basura del id</span></span>
<span id="cb265-3"><a href="manipulación-y-agrupación-de-datos.html#cb265-3" aria-hidden="true" tabindex="-1"></a>specdata <span class="ot">&lt;-</span> specdata_us <span class="sc">%&gt;%</span></span>
<span id="cb265-4"><a href="manipulación-y-agrupación-de-datos.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">monitor =</span> <span class="fu">parse_number</span>(filename)) <span class="sc">%&gt;%</span></span>
<span id="cb265-5"><a href="manipulación-y-agrupación-de-datos.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">id =</span> ID, monitor, <span class="at">date =</span> Date, sulfate, nitrate)</span>
<span id="cb265-6"><a href="manipulación-y-agrupación-de-datos.html#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `mutate()`:</span></span>
<span id="cb265-7"><a href="manipulación-y-agrupación-de-datos.html#cb265-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Problem while computing `monitor = parse_number(filename)`.</span></span>
<span id="cb265-8"><a href="manipulación-y-agrupación-de-datos.html#cb265-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Caused by error in `stopifnot()`:</span></span>
<span id="cb265-9"><a href="manipulación-y-agrupación-de-datos.html#cb265-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! object &#39;filename&#39; not found</span></span>
<span id="cb265-10"><a href="manipulación-y-agrupación-de-datos.html#cb265-10" aria-hidden="true" tabindex="-1"></a>specdata</span>
<span id="cb265-11"><a href="manipulación-y-agrupación-de-datos.html#cb265-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;specdata&#39; not found</span></span></code></pre></div>
</div>
<div id="otras-consideraciones" class="section level3 unnumbered hasAnchor">
<h3>Otras consideraciones<a href="manipulación-y-agrupación-de-datos.html#otras-consideraciones" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En las buenas prácticas es importante tomar en cuenta los siguientes puntos:</p>
<ul>
<li><p>Incluir un encabezado con el nombre de las variables.</p></li>
<li><p>Los nombres de las variables deben ser entendibles (e.g. AgeAtDiagnosis es
mejor que AgeDx).</p></li>
<li><p>En general los datos se deben guardar en un archivo por tabla.</p></li>
<li><p>Escribir un script con las modificaciones que se hicieron a los <em>datos crudos</em>
(reproducibilidad).</p></li>
<li><p>Otros aspectos importantes en la <em>limpieza</em> de datos son: selección del tipo
de variables (por ejemplo fechas), datos faltantes, <em>typos</em> y detección de
valores atípicos.</p></li>
</ul>
</div>
<div id="recursos-adicionales" class="section level3 unnumbered hasAnchor">
<h3>Recursos adicionales<a href="manipulación-y-agrupación-de-datos.html#recursos-adicionales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">Data Import Cheat Sheet</a>,
RStudio.</p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">Data Transformation Cheat Sheet</a>,
RStudio.</p></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comandos-básicos-de-r..html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tarea.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01_manipulacion.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
